<!DOCTYPE html>
<!-- saved from url=(0029)http://127.0.0.1:9000/jatos/2 -->
<html lang="en" data-lt-installed="true"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style id="ace-clouds">.ace-clouds .ace_gutter {background: #ebebeb;color: #333}.ace-clouds .ace_print-margin {width: 1px;background: #e8e8e8}.ace-clouds {background-color: #FFFFFF;color: #000000}.ace-clouds .ace_cursor {color: #000000}.ace-clouds .ace_marker-layer .ace_selection {background: #BDD5FC}.ace-clouds.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #FFFFFF;}.ace-clouds .ace_marker-layer .ace_step {background: rgb(255, 255, 0)}.ace-clouds .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid #BFBFBF}.ace-clouds .ace_marker-layer .ace_active-line {background: #FFFBD1}.ace-clouds .ace_gutter-active-line {background-color : #dcdcdc}.ace-clouds .ace_marker-layer .ace_selected-word {border: 1px solid #BDD5FC}.ace-clouds .ace_invisible {color: #BFBFBF}.ace-clouds .ace_keyword,.ace-clouds .ace_meta,.ace-clouds .ace_support.ace_constant.ace_property-value {color: #AF956F}.ace-clouds .ace_keyword.ace_operator {color: #484848}.ace-clouds .ace_keyword.ace_other.ace_unit {color: #96DC5F}.ace-clouds .ace_constant.ace_language {color: #39946A}.ace-clouds .ace_constant.ace_numeric {color: #46A609}.ace-clouds .ace_constant.ace_character.ace_entity {color: #BF78CC}.ace-clouds .ace_invalid {background-color: #FF002A}.ace-clouds .ace_fold {background-color: #AF956F;border-color: #000000}.ace-clouds .ace_storage,.ace-clouds .ace_support.ace_class,.ace-clouds .ace_support.ace_function,.ace-clouds .ace_support.ace_other,.ace-clouds .ace_support.ace_type {color: #C52727}.ace-clouds .ace_string {color: #5D90CD}.ace-clouds .ace_comment {color: #BCC8BA}.ace-clouds .ace_entity.ace_name.ace_tag,.ace-clouds .ace_entity.ace_other.ace_attribute-name {color: #606060}.ace-clouds .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y}
/*# sourceURL=ace/css/ace-clouds */</style><style>    .error_widget_wrapper {        background: inherit;        color: inherit;        border:none    }    .error_widget {        border-top: solid 2px;        border-bottom: solid 2px;        margin: 5px 0;        padding: 10px 40px;        white-space: pre-wrap;    }    .error_widget.ace_error, .error_widget_arrow.ace_error{        border-color: #ff5a5a    }    .error_widget.ace_warning, .error_widget_arrow.ace_warning{        border-color: #F1D817    }    .error_widget.ace_info, .error_widget_arrow.ace_info{        border-color: #5a5a5a    }    .error_widget.ace_ok, .error_widget_arrow.ace_ok{        border-color: #5aaa5a    }    .error_widget_arrow {        position: absolute;        border: solid 5px;        border-top-color: transparent!important;        border-right-color: transparent!important;        border-left-color: transparent!important;        top: -5px;    }</style><style id="ace-tm">.ace-tm .ace_gutter {background: #f0f0f0;color: #333;}.ace-tm .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-tm .ace_fold {background-color: #6B72E6;}.ace-tm {background-color: #FFFFFF;color: black;}.ace-tm .ace_cursor {color: black;}.ace-tm .ace_invisible {color: rgb(191, 191, 191);}.ace-tm .ace_storage,.ace-tm .ace_keyword {color: blue;}.ace-tm .ace_constant {color: rgb(197, 6, 11);}.ace-tm .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-tm .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-tm .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-tm .ace_invalid {background-color: rgba(255, 0, 0, 0.1);color: red;}.ace-tm .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-tm .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-tm .ace_support.ace_type,.ace-tm .ace_support.ace_class {color: rgb(109, 121, 222);}.ace-tm .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-tm .ace_string {color: rgb(3, 106, 7);}.ace-tm .ace_comment {color: rgb(76, 136, 107);}.ace-tm .ace_comment.ace_doc {color: rgb(0, 102, 255);}.ace-tm .ace_comment.ace_doc.ace_tag {color: rgb(128, 159, 191);}.ace-tm .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-tm .ace_variable {color: rgb(49, 132, 149);}.ace-tm .ace_xml-pe {color: rgb(104, 104, 91);}.ace-tm .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-tm .ace_heading {color: rgb(12, 7, 255);}.ace-tm .ace_list {color:rgb(185, 6, 144);}.ace-tm .ace_meta.ace_tag {color:rgb(0, 22, 142);}.ace-tm .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-tm .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-tm.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px white;}.ace-tm .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-tm .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-tm .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-tm .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-tm .ace_gutter-active-line {background-color : #dcdcdc;}.ace-tm .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-tm .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}
/*# sourceURL=ace/css/ace-tm */</style><style id="ace_editor.css">.ace_br1 {border-top-left-radius    : 3px;}.ace_br2 {border-top-right-radius   : 3px;}.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}.ace_br4 {border-bottom-right-radius: 3px;}.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}.ace_br8 {border-bottom-left-radius : 3px;}.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}.ace_editor {position: relative;overflow: hidden;font: 12px/normal 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace;direction: ltr;text-align: left;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);}.ace_scroller {position: absolute;overflow: hidden;top: 0;bottom: 0;background-color: inherit;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;cursor: text;}.ace_content {position: absolute;box-sizing: border-box;min-width: 100%;contain: style size layout;}.ace_dragging .ace_scroller:before{position: absolute;top: 0;left: 0;right: 0;bottom: 0;content: '';background: rgba(250, 250, 250, 0.01);z-index: 1000;}.ace_dragging.ace_dark .ace_scroller:before{background: rgba(0, 0, 0, 0.01);}.ace_selecting, .ace_selecting * {cursor: text !important;}.ace_gutter {position: absolute;overflow : hidden;width: auto;top: 0;bottom: 0;left: 0;cursor: default;z-index: 4;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;contain: style size layout;}.ace_gutter-active-line {position: absolute;left: 0;right: 0;}.ace_scroller.ace_scroll-left {box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;}.ace_gutter-cell {position: absolute;top: 0;left: 0;right: 0;padding-left: 19px;padding-right: 6px;background-repeat: no-repeat;}.ace_gutter-cell.ace_error {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: 2px center;}.ace_gutter-cell.ace_warning {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");background-position: 2px center;}.ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");background-position: 2px center;}.ace_dark .ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");}.ace_scrollbar {contain: strict;position: absolute;right: 0;bottom: 0;z-index: 6;}.ace_scrollbar-inner {position: absolute;cursor: text;left: 0;top: 0;}.ace_scrollbar-v{overflow-x: hidden;overflow-y: scroll;top: 0;}.ace_scrollbar-h {overflow-x: scroll;overflow-y: hidden;left: 0;}.ace_print-margin {position: absolute;height: 100%;}.ace_text-input {position: absolute;z-index: 0;width: 0.5em;height: 1em;opacity: 0;background: transparent;-moz-appearance: none;appearance: none;border: none;resize: none;outline: none;overflow: hidden;font: inherit;padding: 0 1px;margin: 0 -1px;contain: strict;-ms-user-select: text;-moz-user-select: text;-webkit-user-select: text;user-select: text;white-space: pre!important;}.ace_text-input.ace_composition {background: transparent;color: inherit;z-index: 1000;opacity: 1;}.ace_composition_placeholder { color: transparent }.ace_composition_marker { border-bottom: 1px solid;position: absolute;border-radius: 0;margin-top: 1px;}[ace_nocontext=true] {transform: none!important;filter: none!important;perspective: none!important;clip-path: none!important;mask : none!important;contain: none!important;perspective: none!important;mix-blend-mode: initial!important;z-index: auto;}.ace_layer {z-index: 1;position: absolute;overflow: hidden;word-wrap: normal;white-space: pre;height: 100%;width: 100%;box-sizing: border-box;pointer-events: none;}.ace_gutter-layer {position: relative;width: auto;text-align: right;pointer-events: auto;height: 1000000px;contain: style size layout;}.ace_text-layer {font: inherit !important;position: absolute;height: 1000000px;width: 1000000px;contain: style size layout;}.ace_text-layer > .ace_line, .ace_text-layer > .ace_line_group {contain: style size layout;position: absolute;top: 0;left: 0;right: 0;}.ace_hidpi .ace_text-layer,.ace_hidpi .ace_gutter-layer,.ace_hidpi .ace_content,.ace_hidpi .ace_gutter {contain: strict;will-change: transform;}.ace_hidpi .ace_text-layer > .ace_line, .ace_hidpi .ace_text-layer > .ace_line_group {contain: strict;}.ace_cjk {display: inline-block;text-align: center;}.ace_cursor-layer {z-index: 4;}.ace_cursor {z-index: 4;position: absolute;box-sizing: border-box;border-left: 2px solid;transform: translatez(0);}.ace_multiselect .ace_cursor {border-left-width: 1px;}.ace_slim-cursors .ace_cursor {border-left-width: 1px;}.ace_overwrite-cursors .ace_cursor {border-left-width: 0;border-bottom: 1px solid;}.ace_hidden-cursors .ace_cursor {opacity: 0.2;}.ace_smooth-blinking .ace_cursor {transition: opacity 0.18s;}.ace_animate-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: step-end;animation-name: blink-ace-animate;animation-iteration-count: infinite;}.ace_animate-blinking.ace_smooth-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: ease-in-out;animation-name: blink-ace-animate-smooth;}@keyframes blink-ace-animate {from, to { opacity: 1; }60% { opacity: 0; }}@keyframes blink-ace-animate-smooth {from, to { opacity: 1; }45% { opacity: 1; }60% { opacity: 0; }85% { opacity: 0; }}.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {position: absolute;z-index: 3;}.ace_marker-layer .ace_selection {position: absolute;z-index: 5;}.ace_marker-layer .ace_bracket {position: absolute;z-index: 6;}.ace_marker-layer .ace_active-line {position: absolute;z-index: 2;}.ace_marker-layer .ace_selected-word {position: absolute;z-index: 4;box-sizing: border-box;}.ace_line .ace_fold {box-sizing: border-box;display: inline-block;height: 11px;margin-top: -2px;vertical-align: middle;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");background-repeat: no-repeat, repeat-x;background-position: center center, top left;color: transparent;border: 1px solid black;border-radius: 2px;cursor: pointer;pointer-events: auto;}.ace_dark .ace_fold {}.ace_fold:hover{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");}.ace_tooltip {background-color: #FFF;background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));border: 1px solid gray;border-radius: 1px;box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);color: black;max-width: 100%;padding: 3px 4px;position: fixed;z-index: 999999;box-sizing: border-box;cursor: default;white-space: pre;word-wrap: break-word;line-height: normal;font-style: normal;font-weight: normal;letter-spacing: normal;pointer-events: none;}.ace_folding-enabled > .ace_gutter-cell {padding-right: 13px;}.ace_fold-widget {box-sizing: border-box;margin: 0 -12px 0 1px;display: none;width: 11px;vertical-align: top;background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: center;border-radius: 3px;border: 1px solid transparent;cursor: pointer;}.ace_folding-enabled .ace_fold-widget {display: inline-block;   }.ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");}.ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");}.ace_fold-widget:hover {border: 1px solid rgba(0, 0, 0, 0.3);background-color: rgba(255, 255, 255, 0.2);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);}.ace_fold-widget:active {border: 1px solid rgba(0, 0, 0, 0.4);background-color: rgba(0, 0, 0, 0.05);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);}.ace_dark .ace_fold-widget {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");}.ace_dark .ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget:hover {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);background-color: rgba(255, 255, 255, 0.1);}.ace_dark .ace_fold-widget:active {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);}.ace_inline_button {border: 1px solid lightgray;display: inline-block;margin: -1px 8px;padding: 0 5px;pointer-events: auto;cursor: pointer;}.ace_inline_button:hover {border-color: gray;background: rgba(200,200,200,0.2);display: inline-block;pointer-events: auto;}.ace_fold-widget.ace_invalid {background-color: #FFB4B4;border-color: #DE5555;}.ace_fade-fold-widgets .ace_fold-widget {transition: opacity 0.4s ease 0.05s;opacity: 0;}.ace_fade-fold-widgets:hover .ace_fold-widget {transition: opacity 0.05s ease 0.05s;opacity:1;}.ace_underline {text-decoration: underline;}.ace_bold {font-weight: bold;}.ace_nobold .ace_bold {font-weight: normal;}.ace_italic {font-style: italic;}.ace_error-marker {background-color: rgba(255, 0, 0,0.2);position: absolute;z-index: 9;}.ace_highlight-marker {background-color: rgba(255, 255, 0,0.2);position: absolute;z-index: 8;}
/*# sourceURL=ace/css/ace_editor.css */</style>
<title>JATOS</title>
<link rel="shortcut icon" type="image/png" href="http://127.0.0.1:9000/assets//favicon-96x96.png" sizes="96x96">
<link rel="shortcut icon" type="image/png" href="http://127.0.0.1:9000/assets//favicon-16x16.png" sizes="16x16">
<link rel="shortcut icon" type="image/png" href="http://127.0.0.1:9000/assets//favicon-32x32.png" sizes="32x32">
<link rel="stylesheet" href="./JATOS_files/bootstrap.min.css">
<link rel="stylesheet" href="./JATOS_files/datatables.min.css">
<link rel="stylesheet" href="./JATOS_files/main.css">
<script src="./JATOS_files/jquery-3.5.1.min.js"></script>
<script src="./JATOS_files/popper.min.js"></script>
<script src="./JATOS_files/web-streams-3.0.3-ponyfill.min.js"></script>
<script src="./JATOS_files/StreamSaver.min.js"></script>
<script src="./JATOS_files/showdown.min.js"></script>
<script src="./JATOS_files/ace.js"></script>
<script src="./JATOS_files/bootstrap.min.js"></script>
<script src="./JATOS_files/datatables.min.js"></script>
<script src="./JATOS_files/qr-creator.min.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="./JATOS_files/theme-clouds.js"></script><script src="./JATOS_files/mode-json.js"></script></head>

<body class="modal-open">
<script>

function showSuccess(msg, insertAfterElem, allowHtml = false) {
    msg = allowHtml ? msg : $($.parseHTML(msg)).text();
    var html = '<div class="alert alert-success alert-dismissible" role="alert">'
        + '<button type="button" class="close" data-dismiss="alert">'
        + '<span>&times;</span>'
        + '<span class="sr-only">Close</span></button>'
        + '<i class="glyphicon glyphicon-ok-circle"></i>'
        + '<span>' + msg + '</span>'
        + '</div>';
    if (insertAfterElem) {
        $(html).insertAfter(insertAfterElem);
    } else {
        $(html).insertAfter("#breadcrumbs");
    }
}

function showInfo(msg, insertAfterElem, allowHtml = false) {
    msg = allowHtml ? msg : $($.parseHTML(msg)).text();
    var html = '<div class="alert alert-info alert-dismissible" role="alert">'
        + '<button type="button" class="close" data-dismiss="alert">'
        + '<span>&times;</span>'
        + '<span class="sr-only">Close</span></button>'
        + '<i class="glyphicon glyphicon-eye-open"></i>'
        + '<span>' + msg + '</span>'
        + '</div>';
    if (insertAfterElem) {
        $(html).insertAfter(insertAfterElem);
    } else {
        $(html).insertAfter("#breadcrumbs");
    }
}

function showWarning(msg, insertAfterElem, allowHtml = false) {
    msg = allowHtml ? msg : $($.parseHTML(msg)).text();
    var html = '<div class="alert alert-warning alert-dismissible" role="alert">'
        + '<button type="button" class="close" data-dismiss="alert">'
        + '<span>&times;</span>'
        + '<span class="sr-only">Close</span></button>'
        + '<i class="glyphicon glyphicon-warning-sign"></i>'
        + '<span>' + msg + '</span>'
        + '</div>';
    if (insertAfterElem) {
        $(html).insertAfter(insertAfterElem);
    } else {
        $(html).insertAfter("#breadcrumbs");
    }
}

function showError(msg, insertAfterElem, allowHtml = false) {
    msg = allowHtml ? msg : $($.parseHTML(msg)).text();
    var html = '<div class="alert alert-danger alert-dismissible" role="alert">'
        + '<button type="button" class="close" data-dismiss="alert">'
        + '<span>&times;</span>'
        + '<span class="sr-only">Close</span></button>'
        + '<i class="glyphicon glyphicon-exclamation-sign"></i>'
        + '<span>' + msg + '</span>'
        + '</div>';
    if (insertAfterElem) {
        $(html).insertAfter(insertAfterElem);
    } else {
        $(html).insertAfter("#breadcrumbs");
    }
}

function removeSuccess(elem) {
    if (elem) {
        $(elem).find(".alert-success").remove();
    } else {
        $('#breadcrumbs').nextAll('.alert-success').remove();
    }
}

function removeInfo(elem) {
    if (elem) {
        $(elem).find(".alert-info").remove();
    } else {
        $('#breadcrumbs').nextAll('.alert-info').remove();
    }
}

function removeWarning(elem) {
    if (elem) {
        $(elem).find(".alert-warning").remove();
    } else {
        $('#breadcrumbs').nextAll('.alert-warning').remove();
    }
}

function removeError(elem) {
    if (elem) {
        $(elem).find(".alert-danger").remove();
    } else {
        $('#breadcrumbs').nextAll('.alert-danger').remove();
    }
}

function removeAlerts(elem) {
    removeSuccess(elem);
    removeInfo(elem);
    removeWarning(elem);
    removeError(elem);
}

function showFormErrors(formElem, response) {
    if (response.responseJSON) {
        var errors = response.responseJSON;
        $.each(errors, function(key, errorArray) {
            $.each(errorArray, function(index, msg) {
                showSingleFormError(formElem + " ." + key, msg)
            });
        });
    }
}

function showModalError(formElem, response) {
    if (response.responseText) {
        showError(response.responseText, formElem);
    }
}

function showSingleFormError(selector, msg) {
    $(selector).closest(".form-group").addClass("has-error");
    $(selector).after('<span class="help-block">' + $($.parseHTML(msg)).text() + '</span>');
}

function removeFormErrors(elem) {
    $(elem).find("*").removeClass("has-error");
    $(elem).find(".help-block").remove();
}

function removeSingleFormError(selector) {
    $(selector).closest(".form-group").removeClass("has-error");
    $(selector).nextAll(".help-block").remove();
}

function clearForm(formElem) {
    $(formElem + " input[type=text], input[type=number], input[type=password], textarea").val("");
    $(formElem + " input[type=checkbox]").removeAttr('checked');
    $(formElem + " input[type=radio]").removeAttr('selected');
}

// Adjust the width of every button to the widest one
function setButtonWidthToMax(element) {
    var maxWidth = 0;
    $(element).each(function(index) {
        var width = $(this).width();
        if (width > maxWidth) {
            maxWidth = width;
        }
    });
    $(element).each(function(index) {
        $(this).width(maxWidth);
    });
}

function isJson(string) {
    try {
        $.parseJSON(string);
        return true;
    } catch(error) {
        return false;
    }
}

function getUIWorkerTypeWithGlyphicon(workerType) {
    switch (workerType) {
    case "Jatos":
        return '<span class="noWrap"><span class="glyphicon glyphicon-jatos"></span> Jatos</span>';
    case "PersonalSingle":
        return '<span class="noWrap"><span class="glyphicon glyphicon-personal-single"></span> Personal Single</span>';
    case "PersonalMultiple":
        return '<span class="noWrap"><span class="glyphicon glyphicon-personal-multiple"></span> Personal Multiple</span>';
    case "GeneralSingle":
        return '<span class="noWrap"><span class="glyphicon glyphicon-general-single"></span> General Single</span>';
    case "GeneralMultiple":
        return '<span class="noWrap"><span class="glyphicon glyphicon-general-multiple"></span> General Multiple</span>';
    case "MTSandbox":
        return '<span class="noWrap"><span class="glyphicon glyphicon-mturk-sandbox"></span> MTurk Sandbox</span>';
    case "MT":
        return '<span class="noWrap"><span class="glyphicon glyphicon-mturk"></span> MTurk</span>';
    default:
        return "unknown";
    }
}

</script>


<nav id="jatosHeader" class="navbar navbar-inverse navbar-fixed-top" role="navigation">

    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#jatos-navbar-collapse">
                <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
            </button>
            
            <a class="navbar-brand" href="http://127.0.0.1:9000/jatos">
                <img src="./JATOS_files/jatos_logo_grey.svg" alt="JATOS logo" height="25pt">
            </a>
            <a id="jatosBrandName" class="navbar-brand" href="http://127.0.0.1:9000/jatos">JATOS local</a>
            
        </div>
        <div class="navbar-collapse collapse" id="jatos-navbar-collapse">
            <ul class="nav navbar-nav navbar-left">
                <li data-toggle="tooltip" data-placement="bottom" title="Create a new study">
                    <a id="createStudyLink" href="http://127.0.0.1:9000/jatos/2#">
                        <span class="glyphicon glyphicon-plus"></span>
                        New Study
                    </a>
                </li>
                <li><input id="importStudyBrowser" type="file" name="study" style="display: none;"></li>
                <li data-toggle="tooltip" data-placement="bottom" title="Import a study from the local file system">
                    <a id="importStudyLink" href="http://127.0.0.1:9000/jatos/2#">
                        <span class="glyphicon glyphicon-import"></span>
                        Import Study
                    </a>
                </li>
                
                <li>
                    <a href="http://127.0.0.1:9000/jatos/admin">
                        <span class="glyphicon glyphicon-cog"></span>
                        Administration
                    </a>
                </li>
                
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a id="navUserText" href="http://127.0.0.1:9000/jatos/user/admin">
                    <span class="glyphicon glyphicon-user"></span> Admin
                </a></li>
                <li><a href="http://127.0.0.1:9000/jatos/2#" onclick="logout();"><span class="glyphicon glyphicon-off"></span> Logout</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-sm-3 col-md-2 sidebar">
            <ul id="sidebarStudyList" class="sidebar-nav"><li id="sidebarStudy2" class="studyListItem currentStudy"><span data-toggle="collapse" data-target="#componentsOfStudy2"><span class="glyphicon glyphicon-chevron-right gray-light study-collapsed"></span></span><span class="text-primary" data-toggle="tooltip" data-placement="bottom" title="ID 2" href="/jatos/2">&nbsp;Free exploration paradigm</span><ul id="componentsOfStudy2" class="collapse"><li data-toggle="tooltip" data-placement="bottom" title="ID 2">Consent stage</li><li data-toggle="tooltip" data-placement="bottom" title="ID 3">Choice phase (circular layout)</li><li data-toggle="tooltip" data-placement="bottom" title="ID 4">Guessing phase (categorical response)</li><li data-toggle="tooltip" data-placement="bottom" title="ID 6">Guessing phase (confidence response)</li></ul></li></ul>
        </div>

        <!-- Main -->
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <ol id="breadcrumbs" class="breadcrumb"><li><a href="http://127.0.0.1:9000/jatos">Home</a></li><li class="active">Free exploration paradigm</li></ol>

            
            

<div id="studyDescription" class="panel panel-default" hidden="" style="display: none;">
    <div class="panel-body">
        <div class="text"></div>
        <p class="showAll gradient"><a href="http://127.0.0.1:9000/jatos/2#" class="button">Show all</a></p>
    </div>
</div>

<!-- Toolbar -->
<div id="studyToolbar" class="btn-toolbar" role="toolbar">
    <div class="btn-group">
        <button id="runStudy" type="button" class="btn btn-study" data-toggle="tooltip" data-placement="bottom" title="Runs the study as a JATOS worker in the default batch">
            Run <span class="glyphicon glyphicon-play"></span>
        </button>
        <button id="studyResults" type="button" class="btn btn-study" data-toggle="tooltip" data-placement="bottom" title="Shows study results">
            Study Results <span class="badge" data-toggle="tooltip" data-placement="bottom" title="Number of study results of this study">8</span>
        </button>
        <button id="studyPropertiesButton" type="button" class="btn btn-study" data-toggle="tooltip" data-placement="bottom" title="Edit this study&#39;s properties">
            Properties <span class="glyphicon glyphicon-option-vertical"></span>
        </button>
        <button id="exportStudy" type="button" class="btn btn-study" data-toggle="tooltip" data-placement="bottom" title="Export this study to your local file system (including its components and study assets but without its results)">
            Export <span class="glyphicon glyphicon-export"></span>
        </button>
        <div class="btn-group">
            <button type="button" class="btn btn-study dropdown-toggle" data-toggle="dropdown">
                More <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
                <li data-toggle="tooltip" data-placement="bottom" title="Clone this study without its results">
                    <a id="cloneStudy" href="http://127.0.0.1:9000/jatos/2#">
                        <span class="glyphicon glyphicon-duplicate"></span>
                        Clone
                    </a>
                </li>
                <li data-toggle="tooltip" data-placement="bottom" title="Change who is member of this study">
                    <a id="changeMemberUsersLink" href="http://127.0.0.1:9000/jatos/2#">
                        <span class="glyphicon glyphicon-user"></span>
                        Change&nbsp;Users
                    </a>
                </li>
                <li data-toggle="tooltip" data-placement="bottom" title="Show this study&#39;s log">
                    <a id="showStudyLog" href="http://127.0.0.1:9000/jatos/2#">
                        <span class="glyphicon glyphicon-book"></span>
                        Study Log
                    </a>
                </li>
                <li class="divider"></li>
                <li data-toggle="tooltip" data-placement="bottom" title="Delete this study including its components, assets and results">
                    <a id="removeStudy" href="http://127.0.0.1:9000/jatos/2#">
                        <span class="glyphicon glyphicon-remove"></span>
                        Delete
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <!-- Content and tooltip of lock button is set later in JS -->
    <div class="btn-group">
        <button id="lockStudy" type="button" class="btn btn-study" data-toggle="tooltip" data-placement="bottom" title="Press to lock this study and prohibit changes. Your workers can still run the study.">Unlocked</button>
    </div>
    <div class="btn-group">
        <button id="createComponentLink" type="button" class="btn btn-component" data-toggle="tooltip" data-placement="bottom" title="Create a new component">
            <span class="glyphicon glyphicon-plus"></span>
            New Component
        </button>
    </div>
    <button id="studyLinksButton" type="button" class="btn btn-batch" data-toggle="tooltip" data-placement="bottom" title="Get study links that you can distribute to your workers and let them run your study">
        Study Links
    </button>
</div>

<!-- Components Table -->
<div id="componentsTable_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer"><table id="componentsTable" class="table table-hover table-row-border dataTable no-footer" cellpadding="0" cellspacing="0" border="0" width="100%" role="grid" style="width: 100%; position: relative;">
    <thead>
    <tr role="row"><th data-toggle="tooltip" data-placement="bottom" title="The number in the button shows the position in this study - Use the button to drag and drop the component to a new position" class="componentDragButton sorting_disabled sorting_asc" rowspan="1" colspan="1" style="width: 14px;" aria-label="
            ">
            <span class="glyphicon glyphicon-sort"></span></th><th data-toggle="tooltip" data-placement="bottom" title="Inactive components won&#39;t show up in the next run" class="activeComponent sorting_disabled" rowspan="1" colspan="1" style="width: 42px;" aria-label="Active
        ">Active
        </th><th data-toggle="tooltip" data-placement="bottom" title="ID of this component" class="componentId sorting_disabled" rowspan="1" colspan="1" style="width: 15px;" aria-label="ID">ID</th><th data-toggle="tooltip" data-placement="bottom" title="Title of this component" class="componentTitle sorting_disabled" rowspan="1" colspan="1" style="width: 595px;" aria-label="Title">Title</th><th class="toolbar sorting_disabled" rowspan="1" colspan="1" style="width: 426px;" aria-label=""></th></tr>
    </thead>
    <tbody><tr class="odd"><td class="componentDragButton sorting_1"><button type="button" class="btn btn-component dragButton" data-toggle="tooltip" data-placement="bottom" title="Use this button to drag and drop this component to a new position">
    1</button></td><td class=" activeComponent"><button type="button" class="btn activeButton activeComponent btn-component" data-toggle="tooltip" data-placement="bottom" title="Click to deactivate this component"><span class="glyphicon glyphicon-ok"></span></button></td><td class="componentId">2</td><td class="componentTitle">Consent stage</td><td class=" toolbar">
    <div class="noWrapBtnGroup btn-group">
        <button type="button" class="runComponent btn btn-component" data-toggle="tooltip" data-placement="bottom" title="Runs only this component as a JATOS worker in the default batch">
            Run <span class="glyphicon glyphicon-play"></span>
        </button>
        <button type="button" class="componentResults btn btn-component" data-toggle="tooltip" data-placement="bottom" title="Shows only the results of this component" style="width: 181.484px;">
            Component Results <span class="resultsBadge badge" data-toggle="tooltip" data-placement="bottom" title="Number of component results only of this component">23</span>
        </button>
        <button type="button" class="componentPropertiesButton btn btn-component" data-toggle="tooltip" data-placement="bottom" title="Edit this component&#39;s properties">
            Properties <span class="glyphicon glyphicon-option-vertical"></span>
        </button>
        <div class="btn-group">
            <button type="button" class="btn btn-component dropdown-toggle" data-toggle="dropdown">
                More <span class="caret"></span>
            </button>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                <li data-toggle="tooltip" data-placement="bottom" title="Clone this component without its results and assets">
                    <a class="cloneComponent" href="http://127.0.0.1:9000/jatos/2#">
                        <span class="glyphicon glyphicon-duplicate"></span>
                        Clone
                    </a>
                </li>
                <li class="divider"></li>
                <li data-toggle="tooltip" data-placement="bottom" title="Deletes this component without its results and assets">
                    <a class="removeComponent" href="http://127.0.0.1:9000/jatos/2#">
                        <span class="glyphicon glyphicon-remove"></span>
                        Delete
                    </a>
                </li>
            </ul>
        </div>
    </div>
</td></tr><tr class="even"><td class="componentDragButton sorting_1"><button type="button" class="btn btn-component dragButton" data-toggle="tooltip" data-placement="bottom" title="Use this button to drag and drop this component to a new position">
    2</button></td><td class=" activeComponent"><button type="button" class="btn activeButton activeComponent btn-component" data-toggle="tooltip" data-placement="bottom" title="Click to deactivate this component"><span class="glyphicon glyphicon-ok"></span></button></td><td class="componentId">3</td><td class="componentTitle">Choice phase (circular layout)</td><td class=" toolbar">
    <div class="noWrapBtnGroup btn-group">
        <button type="button" class="runComponent btn btn-component" data-toggle="tooltip" data-placement="bottom" title="Runs only this component as a JATOS worker in the default batch">
            Run <span class="glyphicon glyphicon-play"></span>
        </button>
        <button type="button" class="componentResults btn btn-component" data-toggle="tooltip" data-placement="bottom" title="Shows only the results of this component" style="width: 181.484px;">
            Component Results <span class="resultsBadge badge" data-toggle="tooltip" data-placement="bottom" title="Number of component results only of this component">0</span>
        </button>
        <button type="button" class="componentPropertiesButton btn btn-component" data-toggle="tooltip" data-placement="bottom" title="Edit this component&#39;s properties">
            Properties <span class="glyphicon glyphicon-option-vertical"></span>
        </button>
        <div class="btn-group">
            <button type="button" class="btn btn-component dropdown-toggle" data-toggle="dropdown">
                More <span class="caret"></span>
            </button>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                <li data-toggle="tooltip" data-placement="bottom" title="Clone this component without its results and assets">
                    <a class="cloneComponent" href="http://127.0.0.1:9000/jatos/2#">
                        <span class="glyphicon glyphicon-duplicate"></span>
                        Clone
                    </a>
                </li>
                <li class="divider"></li>
                <li data-toggle="tooltip" data-placement="bottom" title="Deletes this component without its results and assets">
                    <a class="removeComponent" href="http://127.0.0.1:9000/jatos/2#">
                        <span class="glyphicon glyphicon-remove"></span>
                        Delete
                    </a>
                </li>
            </ul>
        </div>
    </div>
</td></tr><tr class="odd"><td class="componentDragButton sorting_1"><button type="button" class="btn btn-component dragButton" data-toggle="tooltip" data-placement="bottom" title="Use this button to drag and drop this component to a new position">
    3</button></td><td class=" activeComponent"><button type="button" class="btn activeButton activeComponent btn-component" data-toggle="tooltip" data-placement="bottom" title="Click to deactivate this component"><span class="glyphicon glyphicon-ok"></span></button></td><td class="componentId">4</td><td class="componentTitle">Guessing phase (categorical response)</td><td class=" toolbar">
    <div class="noWrapBtnGroup btn-group">
        <button type="button" class="runComponent btn btn-component" data-toggle="tooltip" data-placement="bottom" title="Runs only this component as a JATOS worker in the default batch">
            Run <span class="glyphicon glyphicon-play"></span>
        </button>
        <button type="button" class="componentResults btn btn-component" data-toggle="tooltip" data-placement="bottom" title="Shows only the results of this component" style="width: 181.484px;">
            Component Results <span class="resultsBadge badge" data-toggle="tooltip" data-placement="bottom" title="Number of component results only of this component">0</span>
        </button>
        <button type="button" class="componentPropertiesButton btn btn-component" data-toggle="tooltip" data-placement="bottom" title="Edit this component&#39;s properties">
            Properties <span class="glyphicon glyphicon-option-vertical"></span>
        </button>
        <div class="btn-group">
            <button type="button" class="btn btn-component dropdown-toggle" data-toggle="dropdown">
                More <span class="caret"></span>
            </button>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                <li data-toggle="tooltip" data-placement="bottom" title="Clone this component without its results and assets">
                    <a class="cloneComponent" href="http://127.0.0.1:9000/jatos/2#">
                        <span class="glyphicon glyphicon-duplicate"></span>
                        Clone
                    </a>
                </li>
                <li class="divider"></li>
                <li data-toggle="tooltip" data-placement="bottom" title="Deletes this component without its results and assets">
                    <a class="removeComponent" href="http://127.0.0.1:9000/jatos/2#">
                        <span class="glyphicon glyphicon-remove"></span>
                        Delete
                    </a>
                </li>
            </ul>
        </div>
    </div>
</td></tr><tr class="even"><td class="componentDragButton sorting_1"><button type="button" class="btn btn-component dragButton" data-toggle="tooltip" data-placement="bottom" title="Use this button to drag and drop this component to a new position">
    4</button></td><td class=" activeComponent"><button type="button" class="btn activeButton activeComponent btn-component" data-toggle="tooltip" data-placement="bottom" title="Click to deactivate this component"><span class="glyphicon glyphicon-ok"></span></button></td><td class="componentId">6</td><td class="componentTitle">Guessing phase (confidence response)</td><td class=" toolbar">
    <div class="noWrapBtnGroup btn-group">
        <button type="button" class="runComponent btn btn-component" data-toggle="tooltip" data-placement="bottom" title="Runs only this component as a JATOS worker in the default batch">
            Run <span class="glyphicon glyphicon-play"></span>
        </button>
        <button type="button" class="componentResults btn btn-component" data-toggle="tooltip" data-placement="bottom" title="Shows only the results of this component" style="width: 181.484px;">
            Component Results <span class="resultsBadge badge" data-toggle="tooltip" data-placement="bottom" title="Number of component results only of this component">71</span>
        </button>
        <button type="button" class="componentPropertiesButton btn btn-component" data-toggle="tooltip" data-placement="bottom" title="Edit this component&#39;s properties">
            Properties <span class="glyphicon glyphicon-option-vertical"></span>
        </button>
        <div class="btn-group">
            <button type="button" class="btn btn-component dropdown-toggle" data-toggle="dropdown">
                More <span class="caret"></span>
            </button>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                <li data-toggle="tooltip" data-placement="bottom" title="Clone this component without its results and assets">
                    <a class="cloneComponent" href="http://127.0.0.1:9000/jatos/2#">
                        <span class="glyphicon glyphicon-duplicate"></span>
                        Clone
                    </a>
                </li>
                <li class="divider"></li>
                <li data-toggle="tooltip" data-placement="bottom" title="Deletes this component without its results and assets">
                    <a class="removeComponent" href="http://127.0.0.1:9000/jatos/2#">
                        <span class="glyphicon glyphicon-remove"></span>
                        Delete
                    </a>
                </li>
            </ul>
        </div>
    </div>
</td></tr></tbody>
</table></div>

<!-- Template for active button in Component's row -->
<div id="componentActiveButtonDiv" style="display: none">
    <button type="button" class="btn btn-default activeButton" data-toggle="tooltip" data-placement="bottom" title="">
        <span class="glyphicon glyphicon-ok"></span>
    </button>
</div>

<!-- Template for drag button in Component's row -->
<div id="componentDragButtonDiv" style="display: none">
    <button type="button" class="btn btn-component dragButton" data-toggle="tooltip" data-placement="bottom" title="">
    </button>
</div>

<!-- Template for button toolbar in Component's row -->
<div id="componentToolbarDiv" style="display: none">
    <div class="noWrapBtnGroup btn-group">
        <button type="button" class="runComponent btn btn-component" data-toggle="tooltip" data-placement="bottom" title="Runs only this component as a JATOS worker in the default batch">
            Run <span class="glyphicon glyphicon-play"></span>
        </button>
        <button type="button" class="componentResults btn btn-component" data-toggle="tooltip" data-placement="bottom" title="Shows only the results of this component" style="width: 181.484px;">
            Component Results <span class="resultsBadge badge" data-toggle="tooltip" data-placement="bottom" title="Number of component results only of this component"></span>
        </button>
        <button type="button" class="componentPropertiesButton btn btn-component" data-toggle="tooltip" data-placement="bottom" title="Edit this component&#39;s properties">
            Properties <span class="glyphicon glyphicon-option-vertical"></span>
        </button>
        <div class="btn-group">
            <button type="button" class="btn btn-component dropdown-toggle" data-toggle="dropdown">
                More <span class="caret"></span>
            </button>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                <li data-toggle="tooltip" data-placement="bottom" title="Clone this component without its results and assets">
                    <a class="cloneComponent" href="http://127.0.0.1:9000/jatos/2#">
                        <span class="glyphicon glyphicon-duplicate"></span>
                        Clone
                    </a>
                </li>
                <li class="divider"></li>
                <li data-toggle="tooltip" data-placement="bottom" title="Deletes this component without its results and assets">
                    <a class="removeComponent" href="http://127.0.0.1:9000/jatos/2#">
                        <span class="glyphicon glyphicon-remove"></span>
                        Delete
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>


<div class="modal fade" id="changeMemberUsersModal" data-backdrop="static" data-keyboard="true" tabindex="-1" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span>×</span><span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title">Change who is member of this study</h4>
            </div>
            <div class="modal-body">

                <div class="messages"></div>

                <form id="addMemberToStudyForm" action="http://127.0.0.1:9000/jatos/2#" class="form-horizontal col-xs-12" role="form">
                    <label class="control-label" for="username">Add user by username
                        <span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="They have to be a user of JATOS already.">
                        </span>
                    </label>
                    <div class="row">
                        <div class="btn-toolbar" role="toolbar">
                            <div class="col-xs-8">
                                <div class="input-group">
                                    <input type="text" id="username" class="form-control username" name="username" placeholder="username">
                                    <span class="input-group-btn">
                                        <input type="submit" class="btn btn-primary" value="Add">
                                    </span>
                                </div>
                            </div>
                            <div class="btn-group">
                                
                                <button id="removeAllMemberButton" type="button" class="btn btn-primary" data-toggle="tooltip" data-placement="bottom" title="Remove access rights to this study from all users except yourself">
                                    Remove All
                                </button>
                            </div>
                        </div>
                    </div>
                </form>

                <div class="form-group">&nbsp;</div>

                <table class="table" width="100%">
                    <thead>
                        <tr>
                            <th>Member</th>
                            <th>Name</th>
                        </tr>
                    </thead>
                    <!-- Member users are added in JS -->
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Template for member toggle button in user's row -->
<div id="memberToggleButtonDiv" style="display: none">
    <button type="button" class="btn btn-default memberToggleButton" data-toggle="tooltip" data-placement="bottom" title="">
        <span class="glyphicon glyphicon-ok"></span>
    </button>
</div>

<script>

// Max length of each worker table before pagination kicks in
var paginationLength = 10;
var memberUserTable;

$('#studyToolbar').on('click', '#changeMemberUsersLink', function() {
    removeAlerts("#changeMemberUsersModal");
    removeFormErrors("#changeMemberUsersModal");
    clearForm("#addMemberToStudyForm");
    initMemberUserTable();
    
    $('#changeMemberUsersModal').modal('show');
});

function initMemberUserTable() {
    if (typeof memberUserTable != 'undefined') {
        memberUserTable.ajax.reload();
        memberUserTable.draw();
        return;
    }

    memberUserTable = $('#changeMemberUsersModal .table').DataTable({
        "ajax": {
            "type": "GET",
            "url" : "/jatos/" + studyId + "/memberUsers",
            "error": function (err) {
                if (err.responseText) {
                    showError(err.responseText, "#changeMemberUsersModal .messages");
                } else {
                    showError("Cannot read members data.", "#changeMemberUsersModal .messages");
                }
            }
        },
        "initComplete": toggleTablePagination,
        "dom": 'tp',
        "order": [[ 1, "asc" ]],
        "pageLength": paginationLength,
        "columns": [
            { "class": 'memberInStudyColumn',
                "data": null,
                "defaultContent": '',
                "width": "1%",
                "orderable": false,
                "searchable": false,
                "searchable": false,
                "render": function (data, type, full, meta) {
                    var button = $('#memberToggleButtonDiv button:first-child').clone();
                    setMemberButton(button, data.isMember);
                    return button.prop('outerHTML');
                }
            },
            { "data": "name" }
        ]
    });
}

function setMemberButton(button, isMember) {
    if (isMember) {
        button.addClass('isMember');
        button.removeClass('btn-default');
        button.addClass('btn-primary');
        button.attr('title', "Click to remove this user from this study");
        button.html($(button.html())
                .removeClass('glyphicon-remove')
                .addClass('glyphicon-ok').prop('outerHTML'));
    } else {
        button.removeClass('isMember');
        button.removeClass('btn-primary');
        button.addClass('btn-default');
        button.attr('title', "Click to let this user become a member of this study");
        button.html($(button.html())
                .removeClass('glyphicon-ok')
                .addClass('glyphicon-remove').prop('outerHTML'));
    }
}

function toggleTablePagination() {
    var rowNumber = memberUserTable.rows().count();
    var hidePaging = rowNumber <= paginationLength;
    $('#changeMemberUsersModal .table').parent().find('.dataTables_paginate').toggle(!hidePaging);
}

$('#changeMemberUsersModal').on('click', '#addAllMemberButton', function() {
    $.ajax({
        url : '/jatos/' + studyId + '/memberUsers',
        type : "POST",
        success: function(user) {
            removeAlerts("#changeMemberUsersModal");
            memberUserTable.ajax.reload(toggleTablePagination);
        },
        error : function(err) {
            removeAlerts("#changeMemberUsersModal");
            showError(err.responseText, "#changeMemberUsersModal .messages");
        }
    });
});

$('#changeMemberUsersModal').on('click', '#removeAllMemberButton', function() {
    $.ajax({
        url : '/jatos/' + studyId + '/memberUsers',
        type : "DELETE",
        success: function(user) {
            removeAlerts("#changeMemberUsersModal");
            memberUserTable.ajax.reload(toggleTablePagination);
        },
        error : function(err) {
            removeAlerts("#changeMemberUsersModal");
            showError(err.responseText, "#changeMemberUsersModal .messages");
        }
    });
});

$('#addMemberToStudyForm').submit(function(event) {
    event.preventDefault();
    var usernameToChange = $('#addMemberToStudyForm .username').val();
    $.ajax({
        url : '/jatos/' + studyId + '/memberUser?username=' + usernameToChange + '&isMember=true',
        type : "POST",
        success: function(user) {
            removeAlerts("#changeMemberUsersModal");
            alterTableAfterUserAdding(user);
        },
        error : function(err) {
            removeAlerts("#changeMemberUsersModal");
            showError(err.responseText, "#changeMemberUsersModal .messages");
        }
    });
});

function alterTableAfterUserAdding(user) {
    var isAlreadyInTable = false;
    memberUserTable.rows().every(function(rowIdx, tableLoop, rowLoop) {
        var tableMember = this.data();
        if (tableMember.username.toLowerCase() === user.username.toLowerCase()) {
            isAlreadyInTable = true;
            if (tableMember.isMember) {
                var msg = "User " + user.name + " (" + user.username + ") is already member.";
                showInfo(msg, "#changeMemberUsersModal .messages");
            } else {
                var button = $(this.node()).find('.memberToggleButton');
                setMemberButton(button, user.isMember);
            }
            this.data(user);
            return;
        }
    });
    if (!isAlreadyInTable) {
        memberUserTable.row.add(user).draw(false);
        toggleTablePagination();
    }
}

$('#changeMemberUsersModal .table').on('click', '.memberToggleButton', function() {
    var button = this;
    var tr = $(this).closest('tr');
    var tableMember = memberUserTable.row(tr).data();
    //var isMember = $(this).hasClass('isMember');
    if (tableMember.username === "admin" && !tableMember.removeConfirmation) {
        showWarning("Are you sure you want to remove yourself from this study? "
            + "Then click again on the member checkbox.", "#changeMemberUsersModal .messages");
        tableMember.removeConfirmation = true;
        return;
    }
    $.ajax({
        url : '/jatos/' + studyId + '/memberUser?username=' + tableMember.username + '&isMember=' + !tableMember.isMember,
        type : "POST",
        success: function(user) {
            removeAlerts("#changeMemberUsersModal");
            memberUserTable.row(tr).data(user);
            setMemberButton($(button), user.isMember);
        },
        error : function(err) {
            removeAlerts("#changeMemberUsersModal");
            showError(err.responseText, "#changeMemberUsersModal .messages");
        }
    });
});

</script>


<div class="modal fade" id="componentPropertiesModal" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="componentPropertiesForm" method="post" class="form-horizontal" role="form">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span>×</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">Component Properties</h4>
                </div>
                <div class="modal-body">
                    <div class="messages"></div>
                    <div class="form-group">
                        <div class="col-xs-3"><p class="text-right"><strong>ID</strong>&nbsp;<span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="Unique within this JATOS instance"></span></p></div>
                        <div class="col-xs-9">
                            <p class="id"></p>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-xs-3"><p class="text-right"><strong>UUID</strong>&nbsp;<span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="Universally unique identifier - used to keep track of components between different JATOS instances"></span></p></div>
                        <div class="col-xs-9">
                            <p class="uuid"></p>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-3" for="componentTitle">Title&nbsp;<sup>*</sup></label>
                        <div class="col-xs-9">
                            <input type="text" class="form-control title" id="componentTitle" name="title" placeholder="Your component title">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="text-right col-xs-3">
                            Allow reload <span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="If this box is not checked reloading this component&#39;s page will lead to an error and subsequent ending of the whole study."></span>
                        </label>
                        <div class="col-xs-9">
                            <input type="checkbox" class="reloadable" name="reloadable" value="true">
                            <!-- We need a hidden input field. http://stackoverflow.com/questions/8204708/how-do-i-bind-a-checkbox-to-a-boolean-in-play-framework -->
                            <input type="hidden" name="reloadable" value="false">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-3" for="htmlFilePath">HTML file path&nbsp;<sup>*</sup>&nbsp;<span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="Enter the name of your HTML file that displays your component. You can also enter a path to you file. This path must be within the directory of this study&#39;s assets. Use &#39;/&#39; as a directory separator - even on MS Windows."></span></label>
                        <div class="col-xs-9">
                            <div class="input-group" id="htmlFilePath">
                                <span class="input-group-addon">/fep/</span>
                                <input type="text" class="form-control htmlFilePath" id="htmlFilePath" name="htmlFilePath" placeholder="Path to the actual HTML file">
                                <input type="checkbox" class="htmlFileRename" name="htmlFileRename" value="true" hidden="">
                                <input type="hidden" name="htmlFileRename" value="false">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-3" for="componentComments">Comments&nbsp;<span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="Something you want to share or just don&#39;t want to forget?"></span></label>
                        <div class="col-xs-9">
                            <textarea rows="3" class="form-control comments" id="componentComments" name="comments" placeholder="Your comments"></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-3" for="componentJsonData">JSON input&nbsp;<span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="Your component scripts can ask for this input data. You can also leave it empty if not needed."></span><br>
                            <button type="button" class="btn btn-default btn-sm prettyButton">Pretty</button>
                        </label>
                        <div class="col-xs-9">
                            <div class="form-control jsonData" id="componentJsonData"></div>
                            <!-- We use a hidden textarea here to transfer the JSON data into the form POST -->
                            <textarea class="jsonData" name="jsonData" hidden=""></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <input type="submit" name="action" class="confirmed btn btn-component save" value="save">
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Rename HTML filename confirmation  Modal -->
<div class="modal fade" id="htmlFileNameConfirmationModal" data-backdrop="static" tabindex="-1" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span>×</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">HTML filename changed</h4>
            </div>
            <div class="modal-body">
                <div class="modalText"></div>
                <div class="checkbox">
                    <label><input type="checkbox" class="keepHtmlFileName"> Link to a different HTML file</label>
                    <span class="help-block">Check this box to link this component to a different HTML file. This will not rename any files on the disk.</span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="confirmed btn btn-component">OK</button>
            </div>
        </div>
    </div>
</div>

<script>

var componentJsonDataEditor;

$('#studyToolbar').on('click', '#createComponentLink', function() {
    removeAlerts("#componentPropertiesModal");
    removeFormErrors("#componentPropertiesModal");
    clearForm("#componentPropertiesForm");
    $('#componentPropertiesModal .modal-title').text("Create Component");
    $('#componentPropertiesModal .id').closest('.form-group').hide();
    $('#componentPropertiesModal .uuid').closest('.form-group').hide();
    setupComponentJsonDataEditor();
    $('#componentPropertiesModal .save').val("Create");
    $('#componentPropertiesModal input, textarea').not(":input[type=reset]").attr("disabled", false);
    $("#componentPropertiesForm").attr("action", "/jatos/" + studyId + "/component");
    $('#componentPropertiesModal').modal('show');
});

function fillComponentPropertiesForm(properties) {
    $('#componentPropertiesModal').data(properties);

    $('#componentPropertiesModal .modal-title').text("Edit Component Properties");
    var id = (properties['id']) ? properties['id'] : "-";
    $('#componentPropertiesModal .id').text(id);
    $('#componentPropertiesModal .id').closest('.form-group').show();
    var uuid = (properties['uuid']) ? properties['uuid'] : "-";
    $('#componentPropertiesModal .uuid').text(uuid);
    $('#componentPropertiesModal .uuid').closest('.form-group').show();
    $('#componentPropertiesModal .title').val(properties['title']);
    $('#componentPropertiesModal .reloadable').prop('checked', properties['reloadable']);
    $('#componentPropertiesModal .htmlFilePath').val(properties['htmlFilePath']);
    var comments = (properties['comments']) ? properties['comments'] : "";
    $('#componentPropertiesModal .comments').val(comments);
    setupComponentJsonDataEditor();
    try {
        var jsonInput = (properties['jsonData']) ? properties['jsonData'] : "";
        var jsonInputPretty = JSON.stringify(JSON.parse(jsonInput), null, 2);
        componentJsonDataEditor.getSession().setValue(jsonInputPretty);
    } catch (e) {
        componentJsonDataEditor.getSession().setValue("");
    }
    $('#componentPropertiesModal .save').val("Save");
    $('#componentPropertiesModal input, textarea').not(":input[type=reset]").attr("disabled", studyLocked);
    if (studyLocked) {
        showInfo("Study is locked. It&#x27;s not possible to edit.", "#componentPropertiesModal .messages");
    }
    $("#componentPropertiesForm").attr("action", "/jatos/" + studyId + "/"
            + properties['id'] + "/properties");
}

function setupComponentJsonDataEditor() {
    if (componentJsonDataEditor) {
        componentJsonDataEditor.setValue("");
        return;
    }
    var jsonDataDiv = $("#componentPropertiesModal div.jsonData").get(0);
    componentJsonDataEditor = ace.edit(jsonDataDiv);
    componentJsonDataEditor.setTheme("ace/theme/clouds");
    componentJsonDataEditor.session.setMode("ace/mode/json");
    componentJsonDataEditor.setOptions({
        autoScrollEditorIntoView: true,
        showPrintMargin: false,
        wrapBehavioursEnabled: true,
        wrap: true,
        minLines: 8,
        maxLines: 30
    });
}

$('#componentsTable tbody').on('click', '.componentPropertiesButton', function() {
    $.ajax({
        type: 'GET',
        url: "/jatos/" + studyId + "/" + getComponentId(this) + "/properties",
        success: function(response) {
            removeAlerts("#componentPropertiesModal");
            removeFormErrors("#componentPropertiesModal");
            clearForm("#componentPropertiesForm");
            fillComponentPropertiesForm(response);
            $('#componentPropertiesModal').modal('show');
        },
        error: function(response) {
            showError("Couldn't load component properties.");
        }
    });
});

$("#componentPropertiesForm .prettyButton").click(function(event) {
    var jsonInput = componentJsonDataEditor.getSession().getValue();
    removeSingleFormError('#componentPropertiesModal div.jsonData');
    try {
        var jsonInputPretty = JSON.stringify(JSON.parse(jsonInput), null, 2);
        componentJsonDataEditor.getSession().setValue(jsonInputPretty);
    } catch (e) {
        showSingleFormError('#componentPropertiesModal div.jsonData', "Invalid JSON format");
    }
});

$("#componentPropertiesForm").on('click', '.save', function(event) {
    event.preventDefault();

    var oldFileName = $('#componentPropertiesModal').data()['htmlFilePath'];
    var oldFileExists = $('#componentPropertiesModal').data()['htmlFileExists'];
    var newFileName = $('#componentPropertiesModal .htmlFilePath').val().trim();
    if (oldFileName === undefined || !oldFileExists || oldFileName == newFileName) {
        submitComponentPropertiesForm();
    } else {
        var htmlText = "<p>The HTML file linked to this component will be renamed from <b>" + oldFileName + "</b> to <b>" + newFileName + "</b>.</p>";
        $('#htmlFileNameConfirmationModal .modal-body .modalText').html(htmlText);
        $('#htmlFileNameConfirmationModal .keepHtmlFileName').prop('checked', false);
        $('#htmlFileNameConfirmationModal').modal('show');
        $('#htmlFileNameConfirmationModal').off('click.confirmed').on('click.confirmed', '.confirmed', function() {
            $('#htmlFileNameConfirmationModal').modal('hide');
            // Put the checkbox result into the properties form
            var keepHtmlFileName = $('#htmlFileNameConfirmationModal .keepHtmlFileName').prop('checked');
            $('#componentPropertiesModal .htmlFileRename').prop('checked', !keepHtmlFileName);
            submitComponentPropertiesForm();
        });
    }
});

function submitComponentPropertiesForm() {
    // Put JSON from editor into textarea to let it be picked up by form.serialize
    var jsonData = componentJsonDataEditor.getSession().getValue();
    $("#componentPropertiesModal textarea.jsonData").val(jsonData);
    $.ajax({
        type : 'POST',
        url : $("#componentPropertiesForm").attr("action"),
        data : $('#componentPropertiesForm').serialize(),
        success : function(response) {
            removeAlerts("#componentPropertiesModal");
            removeFormErrors("#componentPropertiesModal");
            $('#componentPropertiesModal').modal('hide');
            fillSidebar();
            componentsTable.ajax.reload();
        },
        error : function(response) {
            removeAlerts("#componentPropertiesModal");
            removeFormErrors("#componentPropertiesModal");
            showWarning("Component wasn&#x27;t saved", "#componentPropertiesModal .messages");
            if (isJson(response.responseText)) {
                showFormErrors("#componentPropertiesModal", response);
            } else {
                showModalError("#componentPropertiesModal .messages", response);
            }
        }
    });
}

</script>


<!-- Study Log Modal -->
<div class="modal fade" id="studyLogModal" data-backdrop="static" data-keyboard="true" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span>×</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title">Study Log</h4>
            </div>
            <div class="modal-body">
                <div class="messages"></div>
                <div class="btn-group" data-toggle="buttons">
                    <label class="btn btn-study active">
                        <input id="studyLogPretty" type="radio" name="options" autocomplete="off" checked="">Pretty
                    </label>
                    <label class="btn btn-study">
                        <input id="studyLogRaw" type="radio" name="options" autocomplete="off">Raw
                    </label>
                </div>
                <button id="studyLogDownload" type="button" class="btn btn-study" data-toggle="tooltip" data-placement="bottom" title="Download the whole study log in normal order">Download</button>
                <p>In reverse order:</p>
                <pre><code></code></pre>
            </div>
        </div>
    </div>
</div>

<script>

var studyLogRaw;
var studyLogPretty;

$('#studyToolbar').on('click', '#showStudyLog', function() {
    $.ajax({
        type: 'GET',
        url: "/jatos/2/log?limit=" + 100,
        success: showStudyLogModal,
        error: function(response) {
            showError("Couldn't get study log.");
        }
    });
});

function showStudyLogModal(response) {
    studyLogRaw = response;
    studyLogPretty = response;
    removeAlerts('#studyLogModal');
    var studyLog;
    try {
        studyLog = JSON.parse(studyLogRaw);
    } catch(e) {
        showError("Couldn't parse study log. This study's log is corrupted. You can only see the raw content here.", "#studyLogModal .messages");
        showStudyLogRaw();
        $('#studyLogModal').modal('show');
        return;
    }
    if (studyLog[0] == "Error: Could not open log file") {
        showError("Couldn't get study log.", "#studyLogModal .messages");
    }
    var entryLimit = studyLog.length - 1;
    if (studyLog[entryLimit] == "--- Log is cut here. Download it to get the whole file. ---") {
        var txt = "This study log has more than " + entryLimit + " entries. Only the last " + entryLimit + " entries are shown. To get the whole study log download it and display it locally.";
        showInfo(txt, "#studyLogModal .messages");
    }
    studyLog.forEach(function(entry) {
        if (entry.timestamp) {
            entry.timestamp = new Date(entry.timestamp).toUTCString();
        }
    });
    studyLogPretty = prettifyStudyLogJson(studyLog);
    showStudyLogPretty();
    $('#studyLogModal').modal('show');
}

function prettifyStudyLogJson(studyLog) {
    return JSON.stringify(studyLog, function(key, value) {
        if(key === "workerIds" || key === "dataHashes" || key === "componentUuids") {
            return JSON.stringify(value);
        }
        return value;
    }, 2).replace(/\\/g, '')
            .replace(/\"\[/g, '[')
            .replace(/\]\"/g,']')
            .replace(/\"\{/g, '{')
            .replace(/\}\"/g,'}');
}

$('#studyLogPretty').on('change', showStudyLogPretty);
$('#studyLogRaw').on('change', showStudyLogRaw);

function showStudyLogPretty() {
    $('#studyLogModal code').text(studyLogPretty);
}

function showStudyLogRaw() {
    $('#studyLogModal code').text(studyLogRaw);
}

$('#studyLogDownload').on('click', function() {
    showWaitingModal();
    var url = '/jatos/2/log?limit=-1&download=true';
    var filename = "jatos_studylog_2d732e92-2bef-46a3-849f-6d80e7b085cb.log";
    downloadFileStreaming(url, "", filename);
});


</script>



<script type="text/javascript">
var studyId = 2;
var studyLocked = false;
$(document).ready(setLockButton(studyLocked));

var componentsTable;
$(document).ready(function() {
    // Don't remove pageLength - default is only 10 and it would display only 10 components
    componentsTable = $('#componentsTable').DataTable({
        "ajax": {
            "type": "GET",
            "url" : '/jatos/2/componentsTableData',
            "error": function (err) {
                if (err.responseText) {
                    showError(err.responseText);
                } else {
                    showError("Cannot read components data.");
                }
            }
        },
        "pageLength": 100,
        "dom": 't',
        "columnDefs": [ {
            "searchable": false,
            "orderable": false,
            "targets": "_all"
        } ],
        "columns": [
            {
                "class": 'componentDragButton',
                "data": "position",
                "defaultContent": '',
                "width": "1px",
                "render": function (data, type, full, meta) {
                    var button = $('#componentDragButtonDiv button:first-child').clone();
                    button.html(button.html() + data);
                    button.attr('title', "Use this button to drag and drop this component to a new position");
                    return button.prop('outerHTML');
                }
            },
            {
                "class": 'activeComponent',
                "data": null,
                "defaultContent": '',
                "width": "1px",
                "render": function (data, type, full, meta) {
                    var button = $('#componentActiveButtonDiv button:first-child').clone();
                    setButtonActive(button, data.active);
                    return button.prop('outerHTML');
                }
            },
            {
                "class": "componentId",
                "data": "id",
                "width": "1px"
            },
            {
                "class": "componentTitle",
                "data": "title"
            },
            {
                "class": "toolbar",
                "data": null,
                "defaultContent": '',
                "width": "1%",
                "render": function (data, type, full, meta) {
                    var toolbar = $('#componentToolbarDiv').clone().show();
                    $(toolbar).removeAttr('id');
                    $(toolbar).find('.resultsBadge').text(data.resultCount);
                    return toolbar.html();
                }
            }
        ],
        "createdRow": function(row, data, index) {
            setRowActive($(row), data.active);
        },
        "language": {
            "emptyTable": "No components yet - go to 'Components' and then 'New', to add new components"
        },
        rowReorder: {
            "dataSrc": "position"
        }
    });

    // Adjust the width of every component's toolbar to the widest one
    componentsTable.on('column-sizing.dt', function (e, settings) {
        // Newly created components of an empty study have a negative width (no
        // clue why) - so set the width only if I have at least 2 components
        if ($(".componentResults").length > 1) {
            setButtonWidthToMax(".componentResults");
        }
    });

    componentsTable.on('row-reordered', function (e, details, edit) {
        var componentId = edit.triggerRow.data().id;
        var newPosition = edit.triggerRow.data().position;
        $.ajax({
            url : "/jatos/" + 2 + "/componentOrder"
                    + "?componentId=" + componentId + "&newPosition=" + newPosition,
            type : "POST",
            success : function(response) {
                componentsTable.ajax.reload();
                fillSidebar();
            },
            error : function(err) {
                showError(err.responseText);
            }
        });
    });

    $('#componentsTable tbody').on('click', '.runComponent', function() {
        window.location.href = "/jatos/" + 2 +"/"
            + getComponentId(this) + "/run";
    });

    $('#componentsTable tbody').on('click', '.componentResults', function() {
        window.location.href = "/jatos/" + 2 +"/"
            + getComponentId(this) + "/results";
    });

    $('#componentsTable tbody').on('click', '.cloneComponent', function() {
        $.ajax({
            type: 'GET',
            url: "/jatos/" + 2 +"/" + getComponentId(this) + "/clone",
            success: function(result) {
                showMessages(JSON.parse(result));
                componentsTable.ajax.reload();
                fillSidebar();
            },
            error : function(err) {
                showError(err.responseText);
            }
        });
    });

    $('#componentsTable tbody').on('click', '.removeComponent', function() {
        var element = this;
        var componentId = getComponentId(this);
        if (!componentId) {return} // should never happen
        var componentTitle = getComponentTitle(this);
        var title = "Confirm Delete";
        var htmlText = "<p>You are about to delete component \"" + componentTitle
            + "\" (ID " + componentId + ") <b>with all its results</b>.</p>"
            + "<p><b>This cannot be undone.</b> Do you want to proceed?</p>";
        askConfirmation(title, htmlText, 'Delete', 'btn-component', function() {
            $.ajax({
                url : "/jatos/" + 2 +"/" + componentId,
                type : 'DELETE',
                beforeSend: showWaitingModal,
                success : function(result) {
                    showMessages(JSON.parse(result));
                    componentsTable.ajax.reload();
                    fillSidebar();
                },
                error : function(err) {
                    showError(err.responseText);
                },
                complete: hideWaitingModal
            });
        });
    });

    $('#componentsTable tbody').on('click', '.activeButton', function() {
        var button = this;
        var tr = $(this).closest('tr');
        var componentId = getComponentId(this);
        var active = $(this).hasClass('activeComponent');
        $.ajax({
            url : "/jatos/" + 2 +"/" + componentId
                    + "/properties/active?active=" + !active,
            type : "POST",
            success: function(active) {
                setButtonActive($(button), active);
                setRowActive(tr, active);
            },
            error : function(err) {
                showError(err.responseText);
            }
        });
    });

    function setRowActive(tr, active) {
        if (active) {
            tr.find('.btn, .componentId, .componentTitle').removeClass("grayout");
        } else {
            tr.find('.btn, .componentId, .componentTitle').addClass("grayout");
        }
    }

    function setButtonActive(button, active) {
        if (active) {
            button.addClass('activeComponent');
            button.removeClass('btn-default');
            button.addClass('btn-component');
            button.attr('title', "Click to deactivate this component");
            button.html($(button.html())
                    .removeClass('glyphicon-remove')
                    .addClass('glyphicon-ok').prop('outerHTML'));
        } else {
            button.removeClass('activeComponent');
            button.removeClass('btn-component');
            button.addClass('btn-default');
            button.attr('title', "Click to activate this component");
            button.html($(button.html())
                    .removeClass('glyphicon-ok')
                    .addClass('glyphicon-remove').prop('outerHTML'));
        }
    }
});

function getComponentId(element) {
    var tr = $(element).closest('tr');
    var rowData = componentsTable.row(tr).data();
    return rowData.id;
}

function getComponentTitle(element) {
    var tr = $(element).closest('tr');
    var rowData = componentsTable.row(tr).data();
    return rowData.title;
}

$('#studyToolbar').on('click', '#lockStudy', function() {
    $.ajax({
        url : "/jatos/2/lock/toggle",
        type : "POST",
        success : function(response) {
            studyLocked = response === 'true';
            setLockButton(studyLocked);
            fillSidebar();
        },
        error : function(err) {
            showError(err.responseText);
        }
    });
});

function setLockButton(locked) {
    if (locked) {
        $('#lockStudy').html('Locked');
        $('#lockStudy').addClass('btn-warning');
        $('#lockStudy').removeClass('btn-study');
        $("#lockStudy").attr("title", "Press to unlock this study and allow changes.");
    } else {
        $('#lockStudy').html('Unlocked');
        $('#lockStudy').addClass('btn-study');
        $('#lockStudy').removeClass('btn-warning');
        $("#lockStudy").attr("title", "Press to lock this study and prohibit changes. Your workers can still run the study.");
    }
}

$('#studyToolbar').on('click', '#runStudy', function() {
    window.location.href = "/jatos/2/run";
});

$('#studyToolbar').on('click', '#studyResults', function() {
    window.location.href = "/jatos/2/results";
});

$('#studyToolbar').on('click', '#studyLinksButton', function() {
    window.location.href = "/jatos/2/studyLinks";
});

$('#studyToolbar').on('click', '#exportStudy', function() {
    showWaitingModal();
    download('/jatos/2/export');
});

$('#studyToolbar').on('click', '#removeStudy', function() {
    var title = "Confirm Delete";
    var htmlText = "<p>You are about to delete study \"Free exploration paradigm\" "
        + "(ID 2) "
        + "<b>with all its components, results, and the entire study assets directory, "
        + "including the HTML files</b>.</p>"
        + "<p><b>This cannot be undone.</b> Do you want to proceed?</p>";
    askConfirmation(title, htmlText, 'Delete', 'btn-primary', function() {
        $.ajax({
            url : '/jatos/2',
            type : 'DELETE',
            beforeSend: showWaitingModal,
            success : function(result) {
                window.location.replace('/jatos');
            },
            error : function(err) {
                showError(err.responseText);
            },
            complete: hideWaitingModal
        });
    });
});

$('#studyToolbar').on('click', '#cloneStudy', function() {
    $.ajax({
        url : '/jatos/2/clone',
        type : 'GET',
        success : function(response) {
            fillSidebar();
            var msg = 'Created clone "' + response.title + '". ' +
                '<a href="/jatos/' + response.id + '">Go to this study.</a>';
            showInfo(msg, null, true);
        },
        error : function(err) {
            showError(err.responseText);
        }
    });
});

showStudyDescription();

function showStudyDescription() {
    var studyDescription = $('#studyDescription .text').text();
    // If empty hide
    if (!/\S/.test(studyDescription)) {
        $('#studyDescription').hide();
        return
    }

    var studyDescriptionHtml = new showdown.Converter().makeHtml(studyDescription);
    $('#studyDescription .text').html(studyDescriptionHtml);
    $('#studyDescription').show();

    var longDescription = $('#studyDescription .panel-body').innerHeight() > $('#studyDescription').height()
    if (longDescription) {
        $('#studyDescription .showAll').show();
        $('#studyDescription .showAll').addClass("gradient");
    } else {
        $('#studyDescription .showAll').hide();
    }
}

// Toggle study description with animation (https://css-tricks.com/text-fade-read-more/)
$("#studyDescription .showAll .button").on("click", function() {
    var button = $('#studyDescription .showAll .button');

    var expanded = $('#studyDescription').hasClass("expanded");
    if ($('#studyDescription').hasClass("expanded")) {
        $('#studyDescription').animate({
            "height": 120 // Same height in CSS
        });
        $('#studyDescription .showAll').addClass("gradient");
        button.text("Show more");

    } else {
        // Measure how tall inside should be by adding together heights of all inside paragraphs
        totalHeight = 0
        $('#studyDescription .text').each(function() {
            totalHeight += $(this).outerHeight();
        });

        $('#studyDescription').css({
            // Set height to prevent instant jumpdown when max height is removed
            "height": $('#studyDescription').height(),
            "max-height": 9999
        }).animate({
            "height": totalHeight + 70
        });

        // fade out read-more
        button.text("Show less");
        $('#studyDescription .showAll').removeClass("gradient");
    }

    $('#studyDescription').toggleClass("expanded")

    // Prevent jump-down
    return false;
});


</script>


        </div>
    </div>
</div>

<!-- Confirmation  Modal -->
<div class="modal fade" id="confirmationModal" data-backdrop="static" tabindex="-1" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span>×</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Confirm</h4>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="confirmed btn"></button>
            </div>
        </div>
    </div>
</div>

<!-- Waiting modal -->
<div class="modal fade" id="waitingModal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"><img src="./JATOS_files/waiting.gif">Working</h4>
            </div>
            <div class="modal-body">
                ... might take a while depending on your internet connection and the JATOS server ... please be patient.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default cancel">Cancel</button>
            </div>
        </div>
    </div>
</div>


<!-- Login Modal (used in case of session timeout)-->
<div class="modal fade" id="loginModal" data-backdrop="static" data-keyboard="true" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-sm">
		<div class="modal-content">
			<div class="modal-body">
				
				<form id="loginForm" method="post" class="form-horizontal" role="form">
					<h2 class="form-login-heading">Please log in again</h2>
					<label class="explanation"></label>
					<input type="hidden" class="form-control username" name="username" value="admin" required="">
					<div class="form-group">
						<div class="col-sm-12">
							<label>Password for admin</label>
							<input type="password" class="form-control" name="password" placeholder="Password" autocomplete="off" required="" autofocus="" style="background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAASCAYAAABSO15qAAAAAXNSR0IArs4c6QAAAUBJREFUOBGVVE2ORUAQLvIS4gwzEysHkHgnkMiEc4zEJXCMNwtWTmDh3UGcYoaFhZUFCzFVnu4wIaiE+vvq6+6qTgthGH6O4/jA7x1OiCAIPwj7CoLgSXDxSjEVzAt9k01CBKdWfsFf/2WNuEwc2YqigKZpK9glAlVVwTTNbQJZlnlCkiTAZnF/mePB2biRdhwHdF2HJEmgaRrwPA+qqoI4jle5/8XkXzrCFoHg+/5ICdpm13UTho7Q9/0WnsfwiL/ouHwHrJgQR8WEwVG+oXpMPaDAkdzvd7AsC8qyhCiKJjiRnCKwbRsMw9hcQ5zv9maSBeu6hjRNYRgGFuKaCNwjkjzPoSiK1d1gDDecQobOBwswzabD/D3Np7AHOIrvNpHmPI+Kc2RZBm3bcp8wuwSIot7QQ0PznoR6wYSK0Xb/AGVLcWwc7Ng3AAAAAElFTkSuQmCC&quot;); background-repeat: no-repeat; background-attachment: scroll; background-size: 16px 18px; background-position: 98% 50%;">
						</div>
					</div>
					<button type="submit" class="btn btn-lg btn-primary btn-block">Log in</button>
					<label>Or <a href="http://127.0.0.1:9000/jatos/login">login as a different user</a>.</label>
				</form>
				
			</div>
		</div>
	</div>
</div>

<script>

// Let a background worker check for session timeouts
var sessionTimeoutWorker;
if (window.Worker) {
	sessionTimeoutWorker = new Worker('/assets/lib/jatos-gui/javascripts/sessionTimoutChecker.js');
	sessionTimeoutWorker.postMessage([1440, 60]);
	sessionTimeoutWorker.onmessage = function(msg) {
		showLoginModal(msg.data);
	}
}

function showLoginModal(explanationText) {
	removeAlerts('#loginModal');
	removeFormErrors('#loginModal');
	$('#loginModal .explanation').text(explanationText);
	clearForm("#loginForm");
	
	$('#loginModal').modal('show');
}

$("#loginForm").submit(function(event) {
	event.preventDefault();
	$.ajax({
		type: 'POST',
		url: "/jatos/login",
		data: $('#loginForm').serialize(),
		success: function(response) {
			removeAlerts('#loginModal');
			sessionTimeoutWorker.postMessage([1440, 60]);
			$('#loginModal').modal('hide');
		},
		error: function(response) {
			removeAlerts('#loginModal');
			showModalError("#loginModal .explanation", response);
		}
	});
});

// In case of another modal under the login modal make the other one scrollable after the login one closes
// http://stackoverflow.com/questions/19305821
$(document).on('hidden.bs.modal', '.modal', function () {
	$('.modal:visible').length && $(document.body).addClass('modal-open');
});
	
</script>

<!-- Confirmation Modal - Study Import -->
<div class="modal fade" id="confirmModalStudyImport" tabindex="-1" role="dialog" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span>×</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Study already exists</h4>
            </div>
            <div class="modal-body">
                <div class="modalText"></div>
                <button class="btn btn-default" data-toggle="collapse" data-target="#collapseStudyImportDetails"><span class="glyphicon glyphicon-chevron-right"></span> Details</button>
                <div id="collapseStudyImportDetails" class="collapse">
                    <div class="checkbox">
                        <label><input type="checkbox" id="studysPropertiesConfirm"> Overwrite study's and its components' properties</label>
                        <span class="help-block">Components included in the imported study will be created or updated. Components not included in the imported study will be inactivated but not deleted.</span>
                    </div>
                    <div class="checkbox">
                        <label><input type="checkbox" id="studysDirConfirm"> Overwrite study assets' directory</label>
                        <span class="help-block">This directory contains the study's files like HTML, CSS, and JavaSript files and images.</span>
                    </div>
                </div>
                <p class="modalPostText"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="confirmed btn btn-primary">Overwrite</button>
            </div>
        </div>
    </div>
</div>

<script>

$('#jatosHeader').on('click', '#importStudyLink', function() {
    $('#importStudyBrowser').trigger("click");
});

$('#jatosHeader').on('change', '#importStudyBrowser', function() {
    var data = new FormData();
    var files = $('#importStudyBrowser').prop('files');
    $.each(files , function(index, value){
        data.append('study', value);
    });
    showWaitingModal();
    $.ajax({
        url: '/jatos/import/study',
        data: data,
        cache: false,
        contentType: false,
        processData: false,
        type: 'POST',
        success: function(response) {
            hideWaitingModal();
            importStudyConfirm(response);
        },
        error : function(err) {
            hideWaitingModal();
            showError(err.responseText);
        },
        complete: function() {
            $("#importStudyBrowser")[0].value = '';
        }
    });
});

$('#collapseStudyImportDetails').on('hide.bs.collapse show.bs.collapse', function() {
    $(this).parent().find('.glyphicon-chevron-down, .glyphicon-chevron-right')
        .toggleClass('glyphicon-chevron-right glyphicon-chevron-down');
});

function importStudyConfirm(response) {
    if (response.studyExists && response.uploadedDirExists && response.uploadedDirName == response.currentDirName) {
        // 1) study exists  -  udir exists - udir == cdir : ask confirmation to overwrite study and/or dir
        askConfirmationForStudyExists(response.uploadedStudyTitle, response.uploadedStudyUuid,
                response.uploadedDirName);
    } else if (response.studyExists && response.uploadedDirExists && response.uploadedDirName != response.currentDirName) {
        // 2) study exists  -  udir exists - udir != cdir : ask confirmation to overwrite study and/or (dir && rename to cdir)
        askConfirmationForStudyExistsAndRenameDir(response.uploadedStudyTitle,
                response.uploadedStudyUuid, response.uploadedDirName, response.currentDirName);
    } else if (response.studyExists && !response.uploadedDirExists) {
        // 3) study exists  - !udir exists : shouldn't happen, ask confirmation to overwrite study
        askConfirmationForStudyExists(response.uploadedStudyTitle, response.uploadedStudyUuid,
                        response.uploadedDirName);
    } else if (!response.studyExists && response.uploadedDirExists) {
        // 4) !study exists -  udir exists : ask to rename dir (generate new dir name)
        askConfirmationForStudyNotExistsDirExists(response.uploadedStudyTitle,
                response.uploadedDirName, response.newDirName);
    } else if (!response.studyExists && !response.uploadedDirExists) {
        // 5) !study exists - !udir exists : write both
        askConfirmationForStudyNotExistsDirNotExists(response.uploadedStudyTitle, response.uploadedDirName);
    }
}

function askConfirmationForStudyExists(uploadedStudyTitle, uploadedStudyUuid, uploadedDirName) {
    $('#studysPropertiesConfirm').prop('checked', true);
    $('#studysDirConfirm').prop('checked', true);
    var preText = '<p>It seems a study "' + uploadedStudyTitle + '" (UUID ' + uploadedStudyUuid
        + ') and its study assets\' directory "' + uploadedDirName + '" already exist.</p>'
        + '<p>What do you want to do?</p>';
    $('#confirmModalStudyImport').find('.modalText').html(preText);
    $('#confirmModalStudyImport').on('click', '.checkbox', function() {
        if (!$('#studysPropertiesConfirm').is(':checked')
                && !$('#studysDirConfirm').is(':checked')) {
            $('.confirmed').attr("disabled", true);
        } else {
            $('.confirmed').attr("disabled", false);
        }
    });
    $('#confirmModalStudyImport').find('.confirmed').attr("disabled", false);
    $('#confirmModalStudyImport').modal('show');
    $('#confirmModalStudyImport').off('click.confirm').on('click.confirm', '.confirmed', function() {
        $('#confirmModalStudyImport').modal('hide');
        var studysPropertiesConfirm = $('#studysPropertiesConfirm').is(':checked');
        var studysDirConfirm = $('#studysDirConfirm').is(':checked');
        // Keep the current study assets dir name if the properties aren't overwritten
        var jsonData = JSON.stringify({ "overwriteStudysProperties": studysPropertiesConfirm,
            "overwriteStudysDir" : studysDirConfirm, "keepCurrentDirName": !studysPropertiesConfirm });
        postStudyImportConfirm(jsonData);
    });
}

function askConfirmationForStudyExistsAndRenameDir(uploadedStudyTitle, uploadedStudyUuid,
        uploadedDirName, currentDirName) {
    $('#studysPropertiesConfirm').prop('checked', true);
    $('#studysDirConfirm').prop('checked', true);
    var preText = '<p>It seems a study "' + uploadedStudyTitle + '" (UUID ' + uploadedStudyUuid
        + ') already exist.</p>'
        + '<p>The imported study assets\' directory is "' + uploadedDirName
        + '" - the current one is "' + currentDirName + '". Usually in this case the directory '
        + 'is renamed to the imported version but unfortunately this one already exists and belongs to another study. '
        + 'If you agree the <b>current directory name will be kept</b>.</p>'
        + '<p>What do you want to do?</p>';
    $('#confirmModalStudyImport').find('.modalText').html(preText);
    $('#confirmModalStudyImport').on('click', '.checkbox', function() {
        if (!$('#studysPropertiesConfirm').is(':checked')
                && !$('#studysDirConfirm').is(':checked')) {
            $('.confirmed').attr("disabled", true);
        } else {
            $('.confirmed').attr("disabled", false);
        }
    });
    $('#confirmModalStudyImport').find('.confirmed').attr("disabled", false);
    $('#confirmModalStudyImport').modal('show');
    $('#confirmModalStudyImport').off('click.confirm').on('click.confirm', '.confirmed', function() {
        $('#confirmModalStudyImport').modal('hide');
        var studysPropertiesConfirm = $('#studysPropertiesConfirm').is(':checked');
        var studysDirConfirm = $('#studysDirConfirm').is(':checked');
        var jsonData = JSON.stringify({ "overwriteStudysProperties": studysPropertiesConfirm,
            "overwriteStudysDir" : studysDirConfirm, "keepCurrentDirName": studysDirConfirm });
        postStudyImportConfirm(jsonData);
    });
}

function askConfirmationForStudyNotExistsDirExists(uploadedStudyTitle, uploadedDirName, newDirName) {
    var title = 'Study import - but study assets\' directory already exists';
    var htmlText = '<p>You are about to import the study "' + uploadedStudyTitle + '" '
        + 'and its directory "' + uploadedDirName + '". '
        + 'Unfortunately a directory with this name already exists. '
        + 'If you proceed the directory will be renamed to "' + newDirName + '".</p>'
        + '<p>Do you want to proceed?</p>';
    askConfirmation(title, htmlText, 'Import', "btn-primary", function() {
        var jsonData = JSON.stringify({ "overwriteStudysProperties": true, "overwriteStudysDir" : true,
         "renameDir": true });
        postStudyImportConfirm(jsonData);
    });
}

function askConfirmationForStudyNotExistsDirNotExists(uploadedStudyTitle, uploadedDirName) {
    var title = "Study import";
    var htmlText = '<p>You are about to import the study "' + uploadedStudyTitle
        + '" and its directory "' + uploadedDirName + '".</p>'
        + '<p>Do you want to proceed?</p>';
    askConfirmation(title, htmlText, 'Import', "btn-primary", function() {
        var jsonData = JSON.stringify({ "overwriteStudysProperties": true, "overwriteStudysDir" : true,
         "renameDir": false });
        postStudyImportConfirm(jsonData);
    });
}

function postStudyImportConfirm(jsonData) {
    $.ajax({
        type: 'POST',
        url: '/jatos/import/studyConfirmed',
        contentType: "application/json; charset=utf-8",
        dataType: 'text',
        data: jsonData,
        success: function(result) {
            var msgs = JSON.parse(result);
            showMessages(msgs, true);
            fillSidebar();
            if (typeof componentsTable !== 'undefined') {
                componentsTable.ajax.reload();
            }
        },
        error: function(err) {
            showError(err.responseText);
        }
    });
}

</script>

<div class="modal fade in" id="studyPropertiesModal" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" style="z-index: 1040; display: block; padding-left: 15px;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="studyPropertiesForm" method="post" class="form-horizontal" role="form" action="http://127.0.0.1:9000/jatos/2/properties">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span>×</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">Edit Study Properties</h4>
                </div>
                <div class="modal-body">

                    <div class="messages"></div>

                    <div class="form-group row">
                        <div class="col-xs-3"><p class="text-right"><strong>ID</strong>&nbsp;<span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="Unique within this JATOS instance"></span></p></div>
                        <div class="col-xs-9">
                            <p class="studyId">2</p>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-xs-3"><p class="text-right"><strong>UUID</strong>&nbsp;<span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="Universally unique identifier - used to keep track of studies between different JATOS instances"></span></p></div>
                        <div class="col-xs-9">
                            <p class="uuid">2d732e92-2bef-46a3-849f-6d80e7b085cb</p>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="control-label col-xs-3" for="studyTitle">Title&nbsp;<sup>*</sup></label>
                        <div class="col-xs-9">
                            <input type="text" class="form-control title" id="studyTitle" name="title" placeholder="Your study title">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="control-label col-xs-3" for="description">Description&nbsp;<span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="Explain what your study is doing. In case you want to use the Mechanical Turk, this description will be shown to the participants."></span></label>
                        <div class="col-xs-9">
                            <textarea rows="3" class="form-control description" id="description" name="description" placeholder="Your description"></textarea>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="control-label col-xs-3" for="dirName">Study assets' directory name&nbsp;<sup>*</sup>&nbsp;<span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="Name of the directory that is linked to this study. In there all your study&#39;s assets, e.g. HTML, JavaScript, CSS, and images, will be saved."></span></label>
                        <div class="col-xs-9">
                            <input type="text" class="form-control dirName" id="dirName" name="dirName" placeholder="Study assets&#39; directory name">
                            <input type="checkbox" class="dirRename" name="dirRename" value="true" hidden="">
                            <input type="hidden" name="dirRename" value="false">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="control-label col-xs-3" for="studyComments">Comments&nbsp;<span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="Something you want to share or just don&#39;t want to forget?"></span></label>
                        <div class="col-xs-9">
                            <textarea rows="2" class="form-control comments" id="studyComments" name="comments" placeholder="Your comments"></textarea>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="control-label col-xs-3" for="studyEntryMsg">Study Entry Message&nbsp;<span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="This message can be shown to the worker before the study starts (if the study link format &#39;Confirm First&#39; is chosen). It can be used as a confirmation (or simple consent) or to prevent workers to prematurely start the study. "></span></label>
                        <div class="col-xs-9">
                            <textarea rows="2" class="form-control studyEntryMsg" id="studyEntryMsg" name="studyEntryMsg" placeholder=""></textarea>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="control-label col-xs-3" for="endRedirectUrl">End Redirect URL&nbsp;<span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="To which URL should JATOS redirect to after a run of this study finished. If left empty a default page will be shown."></span></label>
                        <div class="col-xs-9">
                            <input type="text" class="form-control endRedirectUrl" id="endRedirectUrl" name="endRedirectUrl" placeholder="https://">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="control-label col-xs-3" for="studyJsonData">JSON input&nbsp;<span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="Your component scripts can ask for this input data. You can also leave it empty if not needed."></span><br>
                            <button type="button" class="btn btn-default btn-sm prettyButton">Pretty</button>
                        </label>
                        <div class="col-xs-9">
                            <div class="form-control jsonData ace_editor ace_hidpi ace-clouds ace_focus" id="studyJsonData" style="height: 600px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; font-size: 1px; height: 1px; width: 1px; transform: translate(264px, 540px);"></textarea><div class="ace_gutter" aria-hidden="true" style="left: 0px; width: 50px;"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="height: 1e+06px; transform: translate(0px, -140px); width: 50px;"><div class="ace_gutter-cell " style="height: 20px; top: 140px;">8<span class="ace_fold-widget ace_start ace_open" style="height: 20px; display: inline-block;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 160px;">9<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 180px;">10<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 200px;">11<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 220px;">12<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 240px;">13<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 260px;">14<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 280px;">15<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 300px;">16<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 320px;">17<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 340px;">18<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 360px;">19<span class="ace_fold-widget ace_start ace_open" style="height: 20px; display: inline-block;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 380px;">20<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 400px;">21<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 420px;">22<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 440px;">23<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 460px;">24<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 480px;">25<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 500px;">26<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 520px;">27<span class="ace_fold-widget ace_start ace_open" style="height: 20px; display: inline-block;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 540px;">28<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 560px;">29<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 580px;">30<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 600px;">31<span class="ace_fold-widget ace_start ace_open" style="height: 20px; display: inline-block;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 620px;">32<span class="ace_fold-widget ace_start ace_open" style="height: 20px; display: inline-block;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 640px;">33<span class="ace_fold-widget ace_start ace_open" style="height: 20px; display: none;"></span></div><div class="ace_gutter-cell ace_gutter-active-line " style="height: 20px; top: 660px;">34<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 680px;">35<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 700px;">36<span class="ace_fold-widget ace_start ace_open" style="height: 20px; display: none;"></span></div><div class="ace_gutter-cell " style="height: 20px; top: 720px;">37<span class="ace_fold-widget ace_start ace_open" style="height: 20px; display: none;"></span></div></div></div><div class="ace_scroller" style="left: 50px; right: 15px; bottom: 0px;"><div class="ace_content" style="transform: translate(0px, 0px); width: 577px; height: 640px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 676px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"><div class="ace_active-line" style="height: 20px; top: 520px; left: 0px; right: 0px;"></div></div><div class="ace_layer ace_text-layer" style="height: 1e+06px; margin: 0px 4px; transform: translate(0px, -140px);"><div class="ace_line" style="height: 20px; top: 140px;"><span class="ace_indent-guide">    </span>    <span class="ace_variable">"actsOrder"</span>: <span class="ace_paren ace_lparen">[</span></div><div class="ace_line" style="height: 20px; top: 160px;"><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>  <span class="ace_constant ace_numeric">1</span>,</div><div class="ace_line" style="height: 20px; top: 180px;"><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>  <span class="ace_constant ace_numeric">2</span>,</div><div class="ace_line" style="height: 20px; top: 200px;"><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>  <span class="ace_constant ace_numeric">3</span>,</div><div class="ace_line" style="height: 20px; top: 220px;"><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>  <span class="ace_constant ace_numeric">4</span></div><div class="ace_line" style="height: 20px; top: 240px;"><span class="ace_indent-guide">    </span>    <span class="ace_paren ace_rparen">]</span>,</div><div class="ace_line" style="height: 20px; top: 260px;"><span class="ace_indent-guide">    </span>    <span class="ace_variable">"blockSize"</span>: <span class="ace_constant ace_numeric">1</span>,</div><div class="ace_line" style="height: 20px; top: 280px;"><span class="ace_indent-guide">    </span>    <span class="ace_variable">"shuffleOrder"</span>: <span class="ace_constant ace_numeric">1</span></div><div class="ace_line" style="height: 20px; top: 300px;"><span class="ace_indent-guide">    </span>  <span class="ace_paren ace_rparen">}</span>,</div><div class="ace_line" style="height: 20px; top: 320px;"><span class="ace_indent-guide">    </span>  <span class="ace_variable">"maxTrials"</span>: <span class="ace_constant ace_numeric">4</span></div><div class="ace_line" style="height: 20px; top: 340px;">    <span class="ace_paren ace_rparen">}</span>,</div><div class="ace_line" style="height: 20px; top: 360px;">    <span class="ace_paren ace_lparen">{</span></div><div class="ace_line" style="height: 20px; top: 380px;"><span class="ace_indent-guide">    </span>  <span class="ace_variable">"name"</span>: <span class="ace_string">"free"</span>,</div><div class="ace_line" style="height: 20px; top: 400px;"><span class="ace_indent-guide">    </span>  <span class="ace_variable">"feedback"</span>: <span class="ace_constant ace_language ace_boolean">true</span>,</div><div class="ace_line" style="height: 20px; top: 420px;"><span class="ace_indent-guide">    </span>  <span class="ace_variable">"component"</span>: <span class="ace_string">"guess_confidence"</span>,</div><div class="ace_line" style="height: 20px; top: 440px;"><span class="ace_indent-guide">    </span>  <span class="ace_variable">"scheduleParams"</span>: null,</div><div class="ace_line" style="height: 20px; top: 460px;"><span class="ace_indent-guide">    </span>  <span class="ace_variable">"maxTrials"</span>: <span class="ace_constant ace_numeric">5</span></div><div class="ace_line" style="height: 20px; top: 480px;">    <span class="ace_paren ace_rparen">}</span></div><div class="ace_line" style="height: 20px; top: 500px;">  <span class="ace_paren ace_rparen">]</span>,</div><div class="ace_line" style="height: 20px; top: 520px;">  <span class="ace_variable">"compNamePosMap"</span>: <span class="ace_paren ace_lparen">{</span></div><div class="ace_line" style="height: 20px; top: 540px;">    <span class="ace_variable">"guess_confidence"</span>: <span class="ace_constant ace_numeric">4</span>,</div><div class="ace_line" style="height: 20px; top: 560px;">    <span class="ace_variable">"guess_categorical"</span>: <span class="ace_constant ace_numeric">3</span></div><div class="ace_line" style="height: 20px; top: 580px;">  <span class="ace_paren ace_rparen">}</span>,</div><div class="ace_line" style="height: 20px; top: 600px;">  <span class="ace_variable">"default"</span>: <span class="ace_paren ace_lparen">{</span></div><div class="ace_line" style="height: 20px; top: 620px;">    <span class="ace_variable">"overlay"</span>: <span class="ace_paren ace_lparen">{</span></div><div class="ace_line" style="height: 20px; top: 640px;"><span class="ace_indent-guide">    </span>  <span class="ace_variable">"duration"</span>: <span class="ace_constant ace_numeric">5000</span>,</div><div class="ace_line" style="height: 20px; top: 660px;"><span class="ace_indent-guide">    </span>  <span class="ace_variable">"background"</span>: <span class="ace_string">"gray"</span></div><div class="ace_line" style="height: 20px; top: 680px;">    <span class="ace_paren ace_rparen">}</span></div><div class="ace_line" style="height: 20px; top: 700px;">  <span class="ace_paren ace_rparen">}</span></div><div class="ace_line" style="height: 20px; top: 720px;"><span class="ace_paren ace_rparen">}</span></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_animate-blinking"><div class="ace_cursor" style="display: block; transform: translate(214px, 520px); width: 8px; height: 20px; animation-duration: 1000ms;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 740px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 50px; right: 15px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 577px;"></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;">הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה</div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div>
                            <!-- We use a hidden textarea here to transfer the JSON data into the form POST -->
                            <textarea class="jsonData" name="jsonData" hidden=""></textarea>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="text-right col-xs-3">
                            Group study <span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="Is this a group study?"></span>
                        </label>
                        <div class="col-xs-9">
                            <input type="checkbox" class="groupStudy" name="groupStudy" value="true">
                            <!-- We need a hidden input field. http://stackoverflow.com/questions/8204708/how-do-i-bind-a-checkbox-to-a-boolean-in-play-framework -->
                            <input type="hidden" name="groupStudy" value="false">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="text-right col-xs-3">
                            Linear study<br>flow <span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="Should the study flow be linear only?
This still allows reloading of components.
Uncheck this box if you want to jump to an earlier component."></span>
                        </label>
                        <div class="col-xs-9">
                            <input type="checkbox" class="linearStudy" name="linearStudy" value="true">
                            <!-- We need a hidden input field. http://stackoverflow.com/questions/8204708/how-do-i-bind-a-checkbox-to-a-boolean-in-play-framework -->
                            <input type="hidden" name="linearStudy" value="false">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="text-right col-xs-3">
                            Allow preview <span class="glyphicon glyphicon-info-sign gray-light" data-toggle="tooltip" title="Allows a preview of the study run (only with Personal Single or General Single workers): If previews are allowed a study link can be used multiple times by the worker as long as the run stays in the first component. As soon as the second component is started the usual worker restrictions apply."></span>
                        </label>
                        <div class="col-xs-9">
                            <input type="checkbox" class="allowPreview" name="allowPreview" value="true">
                            <!-- We need a hidden input field. http://stackoverflow.com/questions/8204708/how-do-i-bind-a-checkbox-to-a-boolean-in-play-framework -->
                            <input type="hidden" name="allowPreview" value="false">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <input type="submit" class="confirmed btn btn-primary" value="Save">
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Rename study dir name confirmation  Modal -->
<div class="modal fade" id="studyDirNameConfirmationModal" data-backdrop="static" tabindex="-1" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span>×</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Study assets directory name changed</h4>
            </div>
            <div class="modal-body">
                <div class="modalText"></div>
                <div class="checkbox">
                    <label><input type="checkbox" class="keepAssetsDirName"> Link to a different study assets directory</label>
                    <span class="help-block"></span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="confirmed btn btn-study">OK</button>
            </div>
        </div>
    </div>
</div>

<script>

var studyJsonDataEditor;

$('#jatosHeader').on('click', '#createStudyLink', function() {
    removeAlerts("#studyPropertiesModal");
    removeFormErrors("#studyPropertiesModal");
    clearForm("#studyPropertiesForm");
    $('#studyPropertiesModal .modal-title').text("Create Study");
    $('#studyPropertiesModal .studyId').closest('.form-group').hide();
    $('#studyPropertiesModal .uuid').closest('.form-group').hide();
    setupStudyJsonDataEditor();
    $('#studyPropertiesModal .confirmed').val("Create");
    $('#studyPropertiesModal input, textarea').not(":input[type=reset]").attr("disabled", false);
    $("#studyPropertiesForm").attr("action", "/jatos/study");
    $('#studyPropertiesModal').modal('show');
});

$('#studyToolbar').on('click', '#studyPropertiesButton', function() {
    $.ajax({
        type: 'GET',
        url: "/jatos/" + studyId + "/properties",
        success: function(response) {
            removeAlerts("#studyPropertiesModal");
            removeFormErrors("#studyPropertiesModal");
            clearForm("#studyPropertiesForm");
            fillStudyPropertiesForm(response);
            $('#studyPropertiesModal').modal('show');
        },
        error: function(response) {
            showError("Couldn't load study properties.");
        }
    });
});

function fillStudyPropertiesForm(properties) {
    $('#studyPropertiesModal').data(properties);

    $('#studyPropertiesModal .modal-title').text("Edit Study Properties");
    $('#studyPropertiesModal .studyId').text(studyId);
    $('#studyPropertiesModal .studyId').closest('.form-group').show();
    var uuid = (properties['uuid']) ? properties['uuid'] : "-";
    $('#studyPropertiesModal .uuid').text(uuid);
    $('#studyPropertiesModal .uuid').closest('.form-group').show();
    $('#studyPropertiesModal .title').val(properties['title']);
    var description = (properties['description']) ? properties['description'] : "";
    $('#studyPropertiesModal .description').val(description);
    $('#studyPropertiesModal .dirName').val(properties['dirName']);
    var comments = (properties['comments']) ? properties['comments'] : "";
    $('#studyPropertiesModal .comments').val(comments);
    var endRedirectUrl = (properties['endRedirectUrl']) ? properties['endRedirectUrl'] : "";
    $('#studyPropertiesModal .endRedirectUrl').val(endRedirectUrl);
    var studyEntryMsg = (properties['studyEntryMsg']) ? properties['studyEntryMsg'] : "";
    $('#studyPropertiesModal .studyEntryMsg').val(studyEntryMsg);
    setupStudyJsonDataEditor();
    try {
        var jsonInput = (properties['jsonData']) ? properties['jsonData'] : "";
        var jsonInputPretty = JSON.stringify(JSON.parse(jsonInput), null, 2);
        studyJsonDataEditor.getSession().setValue(jsonInputPretty);
    } catch (e) {
        studyJsonDataEditor.getSession().setValue("");
    }
    $('#studyPropertiesModal .groupStudy').prop('checked', properties['groupStudy']);
    $('#studyPropertiesModal .linearStudy').prop('checked', properties['linearStudy']);
    $('#studyPropertiesModal .allowPreview').prop('checked', properties['allowPreview']);
    $('#studyPropertiesModal .confirmed').val("Save");
    $('#studyPropertiesModal input, textarea').not(":input[type=reset]").attr("disabled", properties['locked']);
    if (properties['locked']) {
        showInfo("Study is locked. It&#x27;s not possible to edit.", "#studyPropertiesModal .messages");
    }
    $("#studyPropertiesForm").attr("action", "/jatos/" + studyId + "/properties");
}

function setupStudyJsonDataEditor() {
    if (studyJsonDataEditor) {
        studyJsonDataEditor.setValue("");
        return;
    }
    var jsonDataDiv = $("#studyPropertiesModal div.jsonData").get(0);
    studyJsonDataEditor = ace.edit(jsonDataDiv);
    studyJsonDataEditor.setTheme("ace/theme/clouds");
    studyJsonDataEditor.session.setMode("ace/mode/json");
    studyJsonDataEditor.setOptions({
        autoScrollEditorIntoView: true,
        showPrintMargin: false,
        minLines: 8,
        maxLines: 30
    });
}

$("#studyPropertiesForm .prettyButton").click(function(event) {
    var jsonInput = studyJsonDataEditor.getSession().getValue();
    removeSingleFormError('#studyPropertiesModal div.jsonData');
    try {
        var jsonInputPretty = JSON.stringify(JSON.parse(jsonInput), null, 2);
        studyJsonDataEditor.getSession().setValue(jsonInputPretty);
    } catch (e) {
        showSingleFormError('#studyPropertiesModal div.jsonData', "Invalid JSON format");
    }
});

$("#studyPropertiesForm").submit(function(event) {
    event.preventDefault();

    var oldDirName = $('#studyPropertiesModal').data()['dirName'];
    var newDirName = $('#studyPropertiesModal .dirName').val().trim();
    var newStudyCreation = $("#studyPropertiesForm").attr("action") == "/jatos/study"
    if (oldDirName == newDirName || newStudyCreation) {
        submitStudyPropertiesForm();
    } else {
        var descriptionText = "<p>The name of the study assets' directory linked to this study changed from <b>"
                + oldDirName + "</b> to <b>" + newDirName + "</b>.</p>";
        $('#studyDirNameConfirmationModal .modal-body .modalText').html(descriptionText);
        $('#studyDirNameConfirmationModal .keepAssetsDirName').prop('checked', false);
        var explanationText = "If you check this box the directory on the disk will not be renamed and therefore "
                + "link this study to the different directory '" + newDirName + "'.";
        $('#studyDirNameConfirmationModal .modal-body .help-block').html(explanationText);
        $('#studyDirNameConfirmationModal').modal('show');
        $('#studyDirNameConfirmationModal').off('click.confirmed').on('click.confirmed', '.confirmed', () => {
            $('#studyDirNameConfirmationModal').modal('hide');
            // Put the checkbox result into the properties form
            var keepAssetsDirName = $('#studyDirNameConfirmationModal .keepAssetsDirName').prop('checked');
            $('#studyPropertiesModal .dirRename').prop('checked', !keepAssetsDirName);
            submitStudyPropertiesForm();
        });
    }
});

function submitStudyPropertiesForm() {
    // Put JSON from editor into textarea to let it be picked up by form.serialize
    var jsonData = studyJsonDataEditor.getSession().getValue();
    $("#studyPropertiesModal textarea.jsonData").val(jsonData);
    $.ajax({
        type : 'POST',
        url : $("#studyPropertiesForm").attr("action"),
        data : $('#studyPropertiesForm').serialize(),
        success : function(response) {
            removeAlerts("#studyPropertiesModal");
            removeFormErrors("#studyPropertiesModal");
            $('#studyPropertiesModal').modal('hide');
            // Distinguish between newly created study und edited properties
            var newStudyCreation = $("#studyPropertiesForm").attr("action") == "/jatos/study"
            if (newStudyCreation) {
                // New study's ID is in the response
                window.location.href = "/jatos/" + response;
            } else {
                fillSidebar();
                var title = $('#studyPropertiesModal .title').val();
                $('#breadcrumbs li:last-child').text(title);
                var studyDescription = $('#studyPropertiesModal .description').val();
                $('#studyDescription .text').text(studyDescription);
                showStudyDescription();
            }
        },
        error : function(response) {
            removeAlerts("#studyPropertiesModal");
            removeFormErrors("#studyPropertiesModal");
            showWarning("Study wasn&#x27;t saved", "#studyPropertiesModal .messages");
            if (isJson(response.responseText)) {
                showFormErrors("#studyPropertiesModal", response);
            } else {
                showModalError("#studyPropertiesModal .messages", response);
            }
        }
    });
}
</script>



<script>
var waitingModalTimeout;
var downloadFileAbortController;
var messagesRequestScope = null;
showMessages(messagesRequestScope);
var messagesFlashScope = null;
showMessages(messagesFlashScope);
checkForIE();
var breadcrumbs = [{"name":"Home","url":"/jatos"},{"name":"Free exploration paradigm","url":""}];
showBreadcrumbs(breadcrumbs);
fillSidebar();

function showWaitingModal(cancelable) {
    clearTimeout(waitingModalTimeout);
    if (typeof cancelable === 'boolean' && cancelable === true) {
        $('#waitingModal .modal-footer').show();
    } else {
        $('#waitingModal .modal-footer').hide();
    }
    waitingModalTimeout = setTimeout(function() { $('#waitingModal').modal('show') }, 2000);
}

function hideWaitingModal() {
    clearTimeout(waitingModalTimeout);
    $('#waitingModal').modal('hide');
}

$('#waitingModal').on('click', '.cancel', function(e) {
    if (downloadFileAbortController) downloadFileAbortController.abort();
    hideWaitingModal();
});

function showMessages(messages, allowHtml = false) {
    if (messages != null) {
        if (messages.successList != null) messages.successList.forEach(function(msg) { showSuccess(msg, null, allowHtml) });
        if (messages.infoList != null) messages.infoList.forEach(function(msg) { showInfo(msg, null, allowHtml) });
        if (messages.warningList != null) messages.warningList.forEach(function(msg) { showWarning(msg, null, allowHtml) });
        if (messages.errorList != null) messages.errorList.forEach(function(msg) { showError(msg, null, allowHtml) });
    }
}

function checkForIE() {
    if (window.navigator.userAgent.indexOf("MSIE ") > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) {
        showWarning("JATOS' GUI may not be fully functional in Internet Explorer. Please use other browsers, e.g. Firefox, Edge, Chrome. This applies to the GUI only - your actual studies will run without problems.");
    }
}

function showBreadcrumbs (breadcrumbs) {
    $.each(breadcrumbs, function(index, breadcrumb) {
        var breadcrumbHtml;
        if (breadcrumb.url === null || breadcrumb.url === "") {
            breadcrumbHtml = '<li class="active">' + breadcrumb.name + '</li>';
        } else {
            breadcrumbHtml = '<li><a href="' + breadcrumb.url + '">' + breadcrumb.name + '</a></li>';
        }
        $("#breadcrumbs").append(breadcrumbHtml);
    });
}

function askConfirmation(title, html, buttonText, buttonClass, action) {
    $('#confirmationModal .modal-title').text(title);
    if (html) {
        $('#confirmationModal .modal-body').html(html);
    }
    $('#confirmationModal .confirmed').text(buttonText);
    $('#confirmationModal .confirmed').addClass(buttonClass);
    $('#confirmationModal').modal('show');
    $('#confirmationModal').off('click.confirm').on('click.confirm', '.confirmed', function() {
        $('#confirmationModal').modal('hide');
        $('#confirmationModal .confirmed').removeClass(buttonClass);
        action();
    });
}

function fillSidebar() {
    $.ajax({
        type: 'GET',
        url: '/jatos/sidebarStudyList',
        success: function(result) {
            fillSidebarStudyList(result);
        },
        error : function(err) {
            showError(err.responseText);
        }
    });
}

$('#sidebarStudyList').on('click', '.studyListItem', function(e) {
    // If chevron clicked show study's components
    if ($(e.target).hasClass('glyphicon-chevron-right')
            || $(e.target).hasClass('glyphicon-chevron-down')) {
        $(this).find(".glyphicon-chevron-right, .glyphicon-chevron-down").toggleClass('study-expanded study-collapsed');
        $(this).find(".glyphicon-chevron-right, .glyphicon-chevron-down").toggleClass('glyphicon-chevron-right glyphicon-chevron-down');
    } else {
        var clickedStudyId = $(this).attr('id').replace('sidebarStudy', "");
        window.location.href = '/jatos/' + clickedStudyId;
    }
});

function fillSidebarStudyList(studyArray) {
    $('#sidebarStudyList').empty();
    $.each(studyArray, function(index, study) {
        // Add study
        var listItem = '<li id="sidebarStudy' + study.id + '" class="studyListItem'
        if (typeof studyId !== 'undefined' && study.id == studyId) {
            listItem += ' currentStudy';
        }
        listItem += '">'
                + '<span data-toggle="collapse" data-target="#componentsOfStudy' + study.id + '" >'
                + '<span class="glyphicon glyphicon-chevron-right gray-light study-collapsed"></span>'
                + '</span>'
                + '<span class="text-primary" data-toggle="tooltip" data-placement="bottom" title="ID ' + study.id + '" href="/jatos/' + study.id + '">'
                + '&nbsp;' + study.title;
        if (study.locked) {
            listItem = listItem + '&nbsp;<span class="glyphicon glyphicon-lock gray-light"></span>';
        }
        listItem = listItem + '</span>';

        // Add component list
        var componentsStr = '<ul id="componentsOfStudy' + study.id + '" class="collapse">';
        $.each(study.componentList, function(index, component) {
            componentsStr += '<li data-toggle="tooltip" data-placement="bottom" title="ID '
                    + component.id + '">'
                    + component.title + '</li>';
        });
        componentsStr += '</ul></li>';
        listItem = listItem + componentsStr;
        $('#sidebarStudyList').append(listItem);
    });
}



function logout() {
    var redirectToLogout = function() { window.location.href = "/jatos/logout" };
    
    redirectToLogout();
    
}

$(document).on('show.bs.modal', '.modal', function() {
    var zIndex = 1040 + (10 * $('.modal:visible').length);
    $(this).css('z-index', zIndex);
    setTimeout(function() {
        $('.modal-backdrop').not('.modal-stack').css('z-index', zIndex - 1).addClass('modal-stack');
    }, 0);
});

function downloadFileStreaming(url, postData, filename) {
    downloadFileAbortController = new AbortController();

    // https://jimmywarting.github.io/StreamSaver.js/examples/fetch.html
    const fileStream = streamSaver.createWriteStream(filename);
    var init;
    if (postData) {
        init = {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            cache: 'no-cache',
            body: postData,
            signal: downloadFileAbortController.signal
        };
    } else {
        init = {
            method: 'GET',
            signal: downloadFileAbortController.signal
        };
    }

    fetch(url, init).then(function(response) {
        if (!response.ok) throw new Error(response.statusText);
        return response;
    }).then(function (response) {

        // More optimized but only works in Chrome and Edge so far
        if (window.WritableStream && response.body.pipeTo) {
            return response.body.pipeTo(fileStream).then(hideWaitingModal)
            .catch(function(error) {
                hideWaitingModal();
                showError("Download failed (" + error + ")");
            });
        }

        // Solution for FF (uses more memory)
        window.writer = fileStream.getWriter();
        const reader = response.body.getReader();
        const pump = function() {
            reader.read().then(function(response) {
                if (response.done) {
                    writer.close();
                    hideWaitingModal();
                } else {
                    writer.write(response.value).then(pump);
                }
            }).catch(function(error) {
                hideWaitingModal();
                showError("Download failed (" + error + ")");
            });
        };
        pump();

    }).catch(function(error) {
        hideWaitingModal();
        showError("Download failed (" + error + ")");
    });
}

function download(url) {
    // From https://stackoverflow.com/a/23797348/1278769
    // Doesn't use jQuery

    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.responseType = 'arraybuffer';
    xhr.onload = function () {
        if (this.status === 200) {
            filename = getFilenameFromContentDispositionHeader(xhr);

            var type = xhr.getResponseHeader('Content-Type');
            var blob;
            if (typeof File === 'function') {
                try {
                    blob = new File([this.response], filename, { type: type });
                } catch (e) { /* Edge */ }
            }
            if (typeof blob === 'undefined') {
                blob = new Blob([this.response], { type: type });
            }

            if (typeof window.navigator.msSaveBlob !== 'undefined') {
                // IE workaround for "HTML7007: One or more blob URLs were revoked by closing the blob for which they were created. These URLs will no longer resolve as the data backing the URL has been freed."
                window.navigator.msSaveBlob(blob, filename);
            } else {
                var URL = window.URL || window.webkitURL;
                var downloadUrl = URL.createObjectURL(blob);

                if (filename) {
                    // use HTML5 a[download] attribute to specify filename
                    var a = document.createElement("a");
                    // safari doesn't support this yet
                    if (typeof a.download === 'undefined') {
                        window.location = downloadUrl;
                    } else {
                        a.href = downloadUrl;
                        a.download = filename;
                        document.body.appendChild(a);
                        a.click();
                    }
                } else {
                    window.location = downloadUrl;
                }

                setTimeout(function () { URL.revokeObjectURL(downloadUrl); }, 100); // cleanup
            }
        } else {
            showError("Download failed (" + this.statusText + ")");
        }
        hideWaitingModal();
    };

    xhr.onerror = function (err) {
        hideWaitingModal();
        showError(err.responseText);
    };

    xhr.setRequestHeader('Content-type', 'application/json');
    xhr.send();
}

function getFilenameFromContentDispositionHeader(xhr) {
    // From https://stackoverflow.com/a/40940790/1278769
    var filename;
    var disposition = xhr.getResponseHeader('Content-Disposition');
    if (disposition && disposition.indexOf('attachment') !== -1) {
        var filenameRegex = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;
        var matches = filenameRegex.exec(disposition);
        if (matches != null && matches[1]) {
            filename = matches[1].replace(/['"]/g, '');
        }
    }
    return filename;
}

function getDateTimeYYYYMMDDHHmmss() {
    return new Date().toISOString().replaceAll(/\.\d{3}Z/g, "").replaceAll(/[:\-T\.]/g, "");
}

</script>




<div style="position: static !important;"></div><div class="modal-backdrop fade in modal-stack" style="z-index: 1039;"></div></body></html>